<!DOCTYPE html><html lang="fr-fr"><head>
		<meta charset="utf-8">
		<title>NodeAtlas &#x2014;Le Framework JavaScript Serveur &#xC9;volutif&#x2014;</title>

		<base href="">

		<meta name="geo.placename" content="Annecy, Haute-Savoie, France">
		<meta name="description" content="Cr&#xE9;ez simplement des sites web &#xE9;volutifs en Node.js.">

		<meta name="og:title" content="NodeAtlas &#x2014;Le Framework JavaScript Serveur &#xC9;volutif&#x2014;">
		<meta name="og:description" content="Cr&#xE9;ez simplement des sites web &#xE9;volutifs en Node.js.">
		<meta name="og:url" content="https://node-atlas.js.org">
		<meta name="og:image" content="https://node-atlas.js.org/media/images/min/logo-big.png">
		<meta name="og:locale" content="fr-fr">
		<meta name="og:type" content="website">
		<meta name="og:updated_time" content="1500109617783">

		<meta name="robots" content="index, follow">

		<!--[if IE]><meta name="viewport" content="width=device-width, user-scalable=no" /><![endif]-->
		<!--[if !IE]><!--><meta name="viewport" content="initial-scale=1.0, user-scalable=no"><!--<![endif]-->

		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">

		<!-- Inclusion du fichiers minifié après génération. -->
		
		<link rel="stylesheet" href="stylesheets/common.min.css">

		<!-- Inclusion du fichiers standar pendant le développement. -->
		
	</head>
	<body data-content="content/" data-subpath="" style="background-image: url(&apos;media/images/min/main-background.jpg&apos;);">
		<div class="layout">
			<noscript class="no-js cmpt">
				<div class="no-js--inner">
					<p>Le JavaScript n'est pas activé.</p>
				</div>
			</noscript>
			<div class="background"></div>
			<div class="language cmpt">
				<div class="navigation--lang">
					<a href="/english/index.html" title="International Version"><span class="fa fa-globe"></span>  International Version</a>
				</div>
			</div>
			<header class="header cmpt">
				<div class="header--inner">
					<div class="header--information">
						<div class="header--information--github">
							<a class="header--information--donate" href="https://www.paypal.me/BrunoLesieur/5"><img src="https://img.shields.io/badge/don-%E2%9D%A4-ddddff.svg" alt="Faites un don" data-canonical-src="https://img.shields.io/badge/don-%E2%9D%A4-ddddff.svg"></a>
							<a class="header--information--follow github-button" href="https://github.com/Haeresis" data-count-href="/Haeresis/followers" data-count-api="/users/Haeresis#followers" data-count-aria-label="# followers on GitHub" aria-label="Suivre @Haeresis on GitHub">Suivre</a>
						</div>
						<div class="header--information--npm">
							<a class="header--information--package" href="https://www.npmjs.com/package/node-atlas"><img src="https://badge.fury.io/js/node-atlas.svg" alt="Package NPM" data-canonical-src="https://badge.fury.io/js/node-atlas.svg"></a>
							<a class="header--information--star github-button" href="https://github.com/NodeAtlas/node-atlas" data-icon="octicon-star" data-count-href="/NodeAtlas/node-atlas/stargazers" data-count-api="/repos/NodeAtlas/node-atlas#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star NodeAtlas/node-atlas on GitHub">Star</a>
						</div>
					</div>
					<div class="header--background"></div>
					<div class="header--title">
						<h1>
							<img class="header--title--node" src="media/images/min/ode.png" alt="Node">
							<img class="header--title--atlas" src="media/images/min/tlas.png" alt="Atlas">
							<img class="header--title--trans" src="media/images/min/transparent.png" alt="NodeAtlas">
						</h1>
					</div>
					<div class="header--abstract">
						<p>Le Framework JavaScript Serveur &#xC9;volutif</p>
					</div>
					<div class="header--main">
						<ul>
							<li>
								<div class="header--main--first">
									<h2><span>Mise en place</span> <strong>Simple</strong></h2>
									<p>Au point avec <strong>HTML &amp; CSS</strong> ?<br><strong>D&#xE9;butant</strong> en JavaScript ?</p>
									<p class="small">R&#xE9;alisez rapidement des sites vitrines multilingues sans effort avec l&apos;utilisation de Routes, Vues ou Variations.</p>
								</div>
							</li>
							<li>
								<div class="header--main--second">
									<h2><span>Site vivant et</span> <strong>&#xC9;volutif</strong></h2>
									<p><strong>Expert</strong> en JavaScript client ?<br>Pr&#xEA;t &#xE0; embrasser <strong>Node.js</strong> ?</p>
									<p class="small">Am&#xE9;liorer progressivement votre base &#xE0; mesure de vos besoins en utilisant des Contr&#xF4;leurs, Mod&#xE8;les ou Modules.</p>
								</div>
							</li>
							<li>
								<div class="header--main--third">
									<h2><span>Partie Cliente</span> <strong>Agnostique</strong></h2>
									<p>D&#xE9;j&#xE0; vos habitudes <strong>Front-end</strong> ?<br>Habitu&#xE9;(e) du <strong>Data Binding</strong> ?</p>
									<p class="small">Du l&#xE9;ger Vanilla au simple jQuery en passant par Vue, Angular ou React : utiliser vos biblioth&#xE8;ques clientes favorites !</p>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</header>
<div class="popup cmpt">
	<aside class="popup--inner">
		<div class="popup--versus"><del class="close">Fermer</del><span class="fa fa-bolt" aria-hidden="true"></span><ins class="versus">Versus</ins></div>
		<div class="popup--nodeatlas"></div>
		<div class="popup--challenger"></div>
	</aside>
</div>
			<aside class="download cmpt">
				<div class="download--inner">
					<div class="download--install">
						<div class="download--cli is-active">
							<h2>Utilisation CLI</h2>
							<div class="download--cli--inner">
								<div class="download--cli--step1">
									<h3>Installer NodeAtlas</h3>
									<pre>$ npm install -g node-atlas</pre>
								</div>
								<div class="download--cli--step2">
									<h3>Cr&#xE9;er un site test</h3>
									<pre>$ node-atlas --create</pre>
								</div>
								<div class="download--cli--step3">
									<h3>Lancer le site</h3>
									<pre>$ node-atlas --browse</pre>
								</div>
							</div>
						</div>
						<div class="download--api">
							<h2>Utilisation API</h2>
							<div class="download--api--inner">
								<div class="download--api--step1">
									<h3>Installer NodeAtlas</h3>
									<pre>$ npm install node-atlas</pre>
								</div>
								<div class="download--api--step2">
									<h3>Cr&#xE9;er un script</h3>
									<pre><span>server.js</span>var NA = require(&quot;node-atlas&quot;),
    website = NA();
website.init({
    &quot;create&quot;: &quot;hello-world&quot;
}).created(function () {
    website.run({
        &quot;browse&quot;: true
    });
}).start();</pre>
								</div>
								<div class="download--api--step3">
									<h3>Lancer le site</h3>
									<pre>$ node server.js</pre>
								</div>
							</div>
						</div>
					</div>
					<div class="download--clone">
						<div class="download--version">
							<h2>T&#xE9;l&#xE9;charger</h2>
							<div class="download--version--inner">
								<div class="download--version--step1">
									<h3>v2.0.0-beta44</h3>
									<p class="download--clone--last"><a class="button" href="https://github.com/NodeAtlas/node-atlas/archive/master.zip" target="_blank">Derni&#xE8;re version</a></p>
									<p class="aside"><a href="https://github.com/NodeAtlas/node-atlas/releases">Versions stables</a></p>
								</div>
								<div class="download--version--step2">
									<h3>Cloner</h3>
									<p><input type="text" name="clone" data-instruction="Copier dans le presse-papier: Ctrl+C, Entrer" class="download--clone--text" value="https://github.com/NodeAtlas/node-atlas.git"><button><span class="fa fa-clipboard" aria-hidden="true"></span></button></p>
								</div>
							</div>
						</div>
					</div>
					<div class="download--battle">
						<div class="download--slide">
							<h2>Batailles Versus</h2>
							<div class="download--slide--inner">
								<div class="download--slide--step1">
									<img src="media/images/battles/node-atlas.png" alt="NodeAtlas API">
								</div>
								<div class="download--slide--step2">
									VS
								</div>
								<div class="download--slide--step3">
									<img src="media/images/battles/expressjs.png" alt="Concurrent">
								</div>
								<div class="download--slide--step4">
									<span class="fa fa-refresh" aria-hidden="true">
								</span></div>
							</div>
						</div>
					</div>
					<div class="download--info">
						<div class="download--tuto is-active">
							<h2>Tutoriaux</h2>
							<div class="download--tuto--inner">
								<div class="download--tuto--step1">
									<a href="avant-propos.html#avant-propos"><span>D&#xE9;couvrir</span> <i class="fa fa-book" aria-hidden="true"></i> le guide complet pas &#xE0; pas</a>
								</div>
								<div class="download--tuto--step2">
									<span>ou</span>
								</div>
								<div class="download--tuto--step3">
									<div class="download--tuto--step3--first">
										<a href="https://blog.lesieur.name/des-sites-web-nodejs-pour-les-debutants-en-javascript-avec-nodeatlas/"><span>Cr&#xE9;er</span> <i class="fa fa-html5" aria-hidden="true"></i> des sites web multilingues</a>
									</div>
									<div class="download--tuto--step3--second">
										<a href="https://blog.lesieur.name/creer-et-maintenir-des-maquettes-html-avec-node-atlas/"><span>Maintenir</span> <i class="fa fa-copy" aria-hidden="true"></i> des maquettes HTML sans serveur</a>
									</div>
									<div class="download--tuto--step3--third">
										<a href="https://github.com/NodeAtlas"><span>D&#xE9;velopper</span> <i class="fa fa-database" aria-hidden="true"></i> des applications web temps r&#xE9;el</a>
									</div>
								</div>
							</div>
						</div>
						<div class="download--about">
							<h2>&#xC0; propos</h2>
							<div class="download--about--inner">
								<div class="download--about--step1">
									NodeAtlas est un Framework JavaScript MVC(2) c&#xF4;t&#xE9; serveur vous permettant de cr&#xE9;er des sites &#xE9;volutifs, SEO-compliant et W3C-compliant. C&apos;est-&#xE0;-dire qu&apos;il permet de faire tourner des pages multilingues indexables ou de cr&#xE9;er des maquettes HTML et passant la validation W3C uniquement avec des vues avec modifications &#xE0; chaud mais &#xE9;galement de cr&#xE9;er de gros sites orient&#xE9;s composants et/ou orient&#xE9;s services en respectant les nouveaux standards !
								</div>
							</div>
						</div>
					</div>
				</div>
			</aside>
			<nav class="navigation cmpt">
				<div class="navigation--outer">
					<div class="navigation--start"><button class="button">Commencer</button></div>
					<div class="navigation--documentation"><button class="button">Documentation</button></div>
				</div>
				<div class="navigation--inner">
					<div class="navigation--lang">
						<a href="/english/index.html" title="International Version"><span class="fa fa-globe"></span>  International Version</a>
					</div>
					<div class="navigation--home">
						<img class="navigation--home--logo" src="media/images/logo.png" alt="Guide &lt;span&gt;NodeAtlas&lt;/span&gt;" width="80px"> <a class="navigation--home--back" href="index.html" title="Guide &lt;span&gt;NodeAtlas&lt;/span&gt;">Guide <span>NodeAtlas</span></a>
					</div>
					<div class="navigation--menu">
						<div class="navigation--menu--toggle">
							<span class="top"></span>
							<span class="middle"></span>
							<span class="bottom"></span>
						</div>
						<div class="navigation--menu--list">
							<div class="navigation--menu--list--inner">
								<h2>Menu</h2>
								<ul>
									
									<li>
										<a href="avant-propos.html" title="Pr&#xE9;sentation">Pr&#xE9;sentation</a> 
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="installation.html" title="Installation">Installation</a>
											</li>
											
											<li>
												<a href="commencer-avec-nodeatlas.html" title="D&#xE9;marrage rapide">D&#xE9;marrage rapide</a>
											</li>
											
										</ul>
										
									</li>
									
									<li>
										<a href="partie-vue-et-template.html" title="Vue et Template">Vue et Template</a> 
										
									</li>
									
									<li>
										<a href="partie-controleur-et-modele.html" title="Contr&#xF4;leur et Mod&#xE8;le">Contr&#xF4;leur et Mod&#xE8;le</a> 
										
									</li>
									
									<li>
										<a href="pour-aller-plus-loin.html" title="Route et Plus">Route et Plus</a> 
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="anatomie-du-webconfig.html" title="Webconfig">Webconfig</a>
											</li>
											
											<li>
												<a href="api-nodeatlas-comme-module-npm.html" title="API">API</a>
											</li>
											
											<li>
												<a href="cli-commandes-de-lancement.html" title="CLI">CLI</a>
											</li>
											
											<li>
												<a href="nodeatlas-comme-simple-serveur-web.html" title="Simple Serveur">Simple Serveur</a>
											</li>
											
											<li>
												<a href="environnement-de-developpement.html" title="D&#xE9;veloppement">D&#xE9;veloppement</a>
											</li>
											
											<li>
												<a href="environnement-de-production.html" title="Production">Production</a>
											</li>
											
										</ul>
										
									</li>
									
									<li>
										<a href="plus-sur-nodeatlas.html" title="Et les autres ?">Et les autres ?</a> 
										
									</li>
									
								</ul>
							</div>
						</div>
					</div>
				</div>
			</nav>
			<div class="content cmpt">
				<div class="content--outer" data-name="Menu"></div>
				<div class="content--inner">
					<h2 id="pour-aller-plus-loin">Pour aller plus loin</h2><p>NodeAtlas offre &#xE9;galement tout un syst&#xE8;me de fonctionnalit&#xE9;s de d&#xE9;veloppement et de packaging &#xE0; travers son syt&#xE8;me de configuration. Voyons cela.</p><h3 id="gerer-le-routage-url-rewriting">G&#xE9;rer le routage (Url Rewriting)</h3><p>Bien que vous puissiez param&#xE9;trer des URLs statiques, vous pouvez &#xE9;galement param&#xE9;trer une &#xE9;coute d&apos;URLs dynamiques !</p><h4 id="param-tres">Param&#xE8;tres</h4><p>Il est possible de r&#xE9;cup&#xE9;rer des param&#xE8;tres de l&apos;URL pour afficher un contenu diff&#xE9;rent en fonctions de leurs contenus.</p><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/liste-des-membres/:member/:action/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/liste-des-membres/:member/:action&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/liste-des-membres/:member/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/liste-des-membres/:member&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/liste-des-membres&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;controller&quot;: &quot;members.js&quot;
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>vous pourrez acc&#xE9;der &#xE0; :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres">http://localhost/liste-des-membres</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99">http://localhost/liste-des-membres/bob-eponge99</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/show/">http://localhost/liste-des-membres/node-atlas/show/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc/lolol">http://localhost/liste-des-membres/etc/lolol</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/?example=test">http://localhost/liste-des-membres/?example=test</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc?example=test">http://localhost/liste-des-membres/etc?example=test</a></em> (en POST avec <code>test=This+is+a+test</code>)</li>
</ul><p>et r&#xE9;cup&#xE9;rer les valeurs de <code>:member</code>, <code>:action</code>, <code>example</code> et <code>test</code> dans le <code>changeVariations</code> (common et specific).</p><pre><code class="lang-js">exports.changeVariations = function (next, locals, request, response) {

    console.log(&quot;param request:&quot;, request.params.member);
    // $ undefined, &apos;toto&apos;, &apos;bob-eponge99&apos;, &apos;node-atlas&apos; or &apos;etc&apos;.
    console.log(&quot;param locals:&quot;, locals.params.member);
    // $ undefined, &apos;toto&apos;, &apos;bob-eponge99&apos;, &apos;node-atlas&apos; or &apos;etc&apos;.

    console.log(&quot;param request&quot;, request.params.action);
    // $ undefined, &apos;show&apos; or &apos;lolol&apos;.
    console.log(&quot;param locals&quot;, locals.params.action);
    // $ undefined, &apos;show&apos; or &apos;lolol&apos;.

    console.log(&quot;query request&quot;, request.query.example);
    // $ undefined or &apos;test&apos;
    console.log(&quot;query locals&quot;, locals.query.example);
    // $ undefined or &apos;test&apos;

    console.log(&quot;body request&quot;, request.body.test);
    // $ undefined or &apos;This is a test&apos;.
    console.log(&quot;body locals&quot;, locals.body.test);
    // $ undefined or &apos;This is a test&apos;.

    next();
};
</code></pre><h3 id="parametres-avances">Param&#xE8;tres avanc&#xE9;s</h3><p>Nous voyons que nous utilisons une configuration identique pour trois routes dans l&apos;exemple pr&#xE9;c&#xE9;dent. Vous pouvez &#xE9;galement vous aider d&apos;expressions r&#xE9;guli&#xE8;res pour d&#xE9;finir ce qui peut varier pour acc&#xE9;der &#xE0; votre URL ou pr&#xE9;ciser quels sont les param&#xE8;tres valides dans l&apos;URL. Ce syt&#xE8;me est simplifi&#xE9; &#xE9;tant donn&#xE9; que beaucoup de caract&#xE8;re ne se trouve pas dans l&apos;url. Il n&apos;est donc pas n&#xE9;c&#xE9;ssaire par exemple d&apos;&#xE9;chaper les <code>/</code> par exemple.</p><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/liste-des-membres/?(:member([-a-zA-Z0-9]+)/?(:action(afficher|editer)/?)?)?&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>vous pourrez acc&#xE9;der &#xE0; :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres">http://localhost/liste-des-membres</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99">http://localhost/liste-des-membres/bob-eponge99</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/show/">http://localhost/liste-des-membres/node-atlas/show/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/?example=test">http://localhost/liste-des-membres/?example=test</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc?example=test">http://localhost/liste-des-membres/etc?example=test</a></em> (en POST avec <code>test=This+is+a+test</code>)</li>
</ul><p>et r&#xE9;cup&#xE9;rer les valeurs de <code>:member</code>, <code>:action</code>, <code>example</code> et <code>test</code> dans une vue.</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr-fr&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;URL Rewriting Test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Member: &lt;strong&gt;&lt;?- params.member ?&gt;&lt;/strong&gt;&lt;br&gt;
    Action: &lt;strong&gt;&lt;?- params.action ?&gt;&lt;/strong&gt;&lt;br&gt;
    Example: &lt;strong&gt;&lt;?- query.example ?&gt;&lt;/strong&gt;&lt;br&gt;
    Test: &lt;strong&gt;&lt;?- body.test ?&gt;&lt;/strong&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>vous ne pourrez pas acc&#xE9;der &#xE0; :</p><ul>
<li><em><a href="http://localhost/liste-des-membres/etc/lolol">http://localhost/liste-des-membres/etc/lolol</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/`toto_16`/afficher/">http://localhost/liste-des-membres/`toto_16`/afficher/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/`supprimer`/">http://localhost/liste-des-membres/toto/`supprimer`/</a></em></li>
</ul><h4 id="expressions-r-guli-res">Expressions R&#xE9;guli&#xE8;res</h4><p>Vous pouvez &#xE9;galement activer les expressions r&#xE9;guli&#xE8;res pour un chemin pr&#xE9;cis avec <code>regExp</code>. Si celui-ci vaut <code>true</code>, le pr&#xE9;c&#xE9;dent mode ne fonctionne plus et vous passez en mode Expression R&#xE9;guli&#xE8;re. Si <code>regExp</code> est une chaine de caract&#xE8;re, celle-ci fait office de flag (g, i, m ou y).</p><p>Voyez la configuration suivante :</p><pre><code class="lang-js">{
    &quot;routes&quot;: {
        &quot;/liste-des-membres/([-a-z0-9]+)/?&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;regExp&quot;: &quot;i&quot;
        },
        &quot;/liste-des-membres/?&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;regExp&quot;: true
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>vous pourrez acc&#xE9;der &#xE0; :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres">https://localhost/liste-des-membres</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/toto">https://localhost/liste-des-membres/toto</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99/">http://localhost/liste-des-membres/bob-eponge99/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/bob-eponge99">https://localhost/liste-des-membres/bob-eponge99</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/">http://localhost/liste-des-membres/node-atlas/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/node-atlas">https://localhost/liste-des-membres/node-atlas</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/etc/">http://localhost/liste-des-membres/etc/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/etc">https://localhost/liste-des-membres/etc</a></em>)</em></li>
</ul><p>et r&#xE9;cup&#xE9;rer les valeurs de <code>([-a-z0-9]+)</code> dans le <code>changeVariations</code> (common et specific).</p><pre><code class="lang-js">exports.changeVariation = function (next, locals) {

    if (locals.params &amp;&amp; locals.params[0]) { locals.params.member = locals.params[0]; }
    // locals.params[1] pour le deuxi&#xE8;me match, etc...

    console.log(locals.params.member);
    // $ &apos;toto&apos;, &apos;bob-eponge99&apos;, &apos;node-atlas&apos; ou &apos;etc&apos;.

    next();
}
</code></pre><p>Les r&#xE8;gles de cr&#xE9;ation d&apos;url dynamique avec <code>regExp</code> sont celles des <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScripts/Reference/Global_Objects/RegExp">RegExp JavaScript</a>.</p><h3 id="gerer-les-pages-inexistantes">G&#xE9;rer les pages inexistantes</h3><h4 id="-couter-toutes-les-urls-m-me-les-adresses-du-dossier-assetsrelativepath-">&#xC9;couter toutes les urls, m&#xEA;me les adresses du dossier <code>assetsRelativePath</code></h4><p>Pour afficher une page personnalis&#xE9;e quand une ressource n&apos;est pas trouv&#xE9;e il faut :</p><ol>
<li>Pr&#xE9;parer une page 404.</li>
<li>Remplir le param&#xE8;tre <code>pageNotFound</code> avec comme <code>value</code> la <code>key</code> de la page 404 pr&#xE9;par&#xE9;e.</li>
</ol><p>Voyez l&apos;exemple ci-dessous :</p><pre><code class="lang-json">{
    &quot;pageNotFound&quot;: &quot;/pages-inexistantes/&quot;,
    &quot;routes&quot;: {
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;/pages-inexistantes/&quot;: {
            &quot;view&quot;: &quot;error.htm&quot;,
            &quot;statusCode&quot;: 404
        }
    }
}
</code></pre><p>vous pourrez acc&#xE9;der &#xE0; :</p><ul>
<li><em><a href="http://localhost/cette-page-n-existe-pas.html">http://localhost/cette-page-n-existe-pas.html</a></em></li>
<li><em><a href="http://localhost/elle/non/plus/">http://localhost/elle/non/plus/</a></em></li>
<li><em><a href="http://localhost/etc">http://localhost/etc</a></em></li>
</ul><h4 id="page-d-erreur-localis-e">Page d&apos;erreur localis&#xE9;e</h4><p>Il vous suffit de cr&#xE9;er une nouvelle route finissant par <code>*</code> dans la langue souhait&#xE9;e.</p><p>Voyez l&apos;exemple ci-dessous :</p><pre><code class="lang-json">{
    &quot;pageNotFound&quot;: &quot;/pages-inexistantes/&quot;,
    &quot;languageCode&quot;: &quot;fr-fr&quot;,
    &quot;routes&quot;: {
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;variation&quot;: &quot;members.json&quot;
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;,
            &quot;variation&quot;: &quot;index.json&quot;
        },
        &quot;/pages-inexistantes/&quot;: {
            &quot;view&quot;: &quot;error.htm&quot;,
            &quot;variation&quot;: &quot;error.json&quot;,
            &quot;statusCode&quot;: 404
        },
        &quot;/english/list-of-members/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;languageCode&quot;: &quot;en-gb&quot;,
            &quot;variation&quot;: &quot;members.json&quot;
        },
        &quot;/english/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;,
            &quot;languageCode&quot;: &quot;en-gb&quot;,
            &quot;variation&quot;: &quot;index.json&quot;
        },
        &quot;/english/*&quot;: {
            &quot;view&quot;: &quot;error.htm&quot;,
            &quot;languageCode&quot;: &quot;en-gb&quot;,
            &quot;variation&quot;: &quot;error.json&quot;,
            &quot;statusCode&quot;: 404
        }
    }
}
</code></pre><h3 id="injecter-des-routes-dynamiquement">Injecter des routes dynamiquement</h3><p>Nous avons pu voir qu&apos;avec <code>setRoutes</code> il &#xE9;tait possible d&apos;injecter dynamiquement des routes. Cependant, l&apos;injection de route ne se fait qu&apos;&#xE0; la fin car <code>NA.webconfig.routes</code> est un objet. Il n&apos;y a donc pas de moyen d&apos;ordonner les routes, ce qui est g&#xE9;nant car les routes sont r&#xE9;solu dans l&apos;ordre dans lesquels elles ont &#xE9;t&#xE9; inject&#xE9;es.</p><p>Nous allons r&#xE9;soudre &#xE7;a en changeant la mani&#xE8;re de cr&#xE9;er les routes de <code>routes: { &lt;key&gt;: { ... } }</code> &#xE0; <code>routes: [{ &quot;key&quot;: &lt;key&gt;, ... }]</code>.</p><p>Voici l&apos;ensemble de fichier suivant :</p><pre><code>&#x251C;&#x2500; controllers/
&#x2502;  &#x2514;&#x2500; common.js
&#x251C;&#x2500; views/
&#x2502;  &#x251C;&#x2500; index.htm
&#x2502;  &#x251C;&#x2500; content.htm
&#x2502;  &#x2514;&#x2500; error.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>Avec le <code>webconfig.json</code> initialement comme ceci avec <code>routes: &lt;Object&gt;</code> :</p><pre><code class="lang-json">{
    &quot;controller&quot;: &quot;common.js&quot;,
    &quot;routes&quot;: {
        &quot;/doc/index.html&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;/doc/*&quot;: {
            &quot;view&quot;: &quot;error.htm&quot;,
            &quot;statusCode&quot;: 404
        }
    }
}
</code></pre><p>se transformant en cela avec <code>routes: &lt;Array&gt;</code> :</p><pre><code class="lang-json">{
    &quot;controller&quot;: &quot;common.js&quot;,
    &quot;routes&quot;: [{
        &quot;url&quot;: &quot;/doc/index.html
        &quot;view&quot;: &quot;index.htm&quot;
    }, {
        &quot;url&quot;: &quot;/doc/*&quot;,
        &quot;view&quot;: &quot;error.htm&quot;,
        &quot;statusCode&quot;: 404
    }]
}
</code></pre><p>Avec le fichier &#xAB; common.js &#xBB; nous pouvons maintenant injecter les routes &#xE0; des positions pr&#xE9;cise. Nous allons les ajout&#xE9;s au d&#xE9;but.</p><pre><code class="lang-json">// On intervient au niveau des routes pendant qu&apos;elles sont ajout&#xE9;es.
// Ce code sera ex&#xE9;cut&#xE9; au lancement de NodeAtlas.
exports.setRoutes = function (next) {

    // On r&#xE9;cup&#xE8;re l&apos;instance de NodeAtlas en cours.
    var NA = this,

        // Et nous r&#xE9;cup&#xE9;rons les routes en provenance du webconfig...
        route = NA.webconfig.routes;

    // ...pour ajouter la route &quot;/content.html&quot; au d&#xE9;buts de nos routes.
    route.unshift({
        &quot;url&quot;: &quot;/doc/content.html&quot;,
        &quot;view&quot;: &quot;content.htm&quot;
    });

    // On redonne la main &#xE0; NodeAtlas pour la suite.
    next();
};
</code></pre><p>De cette mani&#xE8;re l&apos;adresse <code>http://localhost/doc/content.html</code> renverra la vue <code>content.htm</code> et non la vue <code>error.htm</code> en 404.</p><h3 id="gerer-les-redirections">G&#xE9;rer les redirections</h3><p>Pour aller &#xE0; une autre adresse (redirection 301 ou 302) quand vous arrivez &#xE0; une url il faut utiliser le param&#xE8;tre <code>redirect</code>.</p><p><em>Note : si vous ne pr&#xE9;cisez pas un <code>statusCode</code>, la redirection ne se fera pas. Le <code>statusCode</code> est obligatoire.</em></p><h4 id="en-statique">En statique</h4><p>Voyez l&apos;exemple ci-dessous :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/liste-des-membres&quot;: {
            &quot;redirect&quot;: &quot;/liste-des-membres/&quot;,
            &quot;statusCode&quot;: 301
        },
        &quot;/aller-sur-node-atlas/&quot;: {
            &quot;redirect&quot;: &quot;https://node-atlas.js.org/&quot;,
            &quot;statusCode&quot;: 302
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Vous serez redirig&#xE9; :</p><ul>
<li>sur <code>http://localhost/liste-des-membres/</code> quand vous acc&#xE9;derez &#xE0; <code>http://localhost/liste-des-membres</code> avec une ent&#xEA;te <em>redirection permanente</em>.</li>
<li>sur <code>https://node-atlas.js.org/</code> quand vous acc&#xE9;derez &#xE0; <code>http://localhost/aller-sur-node-atlas/</code> avec une ent&#xEA;te <em>redirection temporaire</em>.</li>
</ul><h4 id="en-dynamique">En dynamique</h4><p>Voyez l&apos;exemple ci-dessous :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/liste-des-membres/:member/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/liste-des-membres/:member&quot;: {
            &quot;redirect&quot;: &quot;/liste-des-membres/:member/&quot;,
            &quot;statusCode&quot;: 301
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Vous serez redirig&#xE9; sur <code>http://localhost/liste-des-membres/haeresis/</code> quand vous acc&#xE9;derez &#xE0; <code>http://localhost/liste-des-membres/haeresis</code> avec une ent&#xEA;te <em>redirection permanente</em>.</p><h4 id="avec-expressions-r-guli-res">Avec expressions r&#xE9;guli&#xE8;res</h4><p>Voyez l&apos;exemple ci-dessous :</p><pre><code class="lang-js">{
    &quot;routes&quot;: {
        &quot;/membres/([-a-z0-9]+)/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;,
            &quot;regExp&quot;: true
        },
        &quot;/liste-des-membres/([-a-z0-9]+)/&quot;: {
            &quot;redirect&quot;: &quot;/membres/$0/&quot;,
            &quot;statusCode&quot;: 301,
            &quot;regExp&quot;: true
        },
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Vous serez redirig&#xE9; sur <code>http://localhost/membres/haeresis/</code> quand vous acc&#xE9;derez &#xE0; <code>http://localhost/liste-des-membres/haeresis/</code> avec une ent&#xEA;te <em>redirection permanente</em>.</p><p>Pour le second <em>match</em> utilisez $1, pour le troisi&#xE8;me $2, etc.</p><h3 id="gerer-les-headers-de-page">G&#xE9;rer les Headers de page</h3><p>Par d&#xE9;faut, les Headers envoy&#xE9; par NodeAtlas sont les suivants : <code>Content-Type:text/html; charset=utf-8</code> avec un <code>statusCode</code> &#xE0; 200.</p><p>Il est tout &#xE0; fait possible de modifier ses valeurs pour une entr&#xE9;e de route pour des APIs local au site.</p><pre><code class="lang-json">{
    &quot;mimeType&quot;: &quot;application/json&quot;,
    &quot;charset&quot;: &quot;utf-16&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;,
            &quot;mimeType&quot;: &quot;text/html&quot;
        },
        &quot;/api/articles&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;controller&quot;: &quot;blog/list-of-articles.js&quot;,
            &quot;charset&quot;: &quot;utf-8&quot;,
            &quot;statusCode&quot;: 203
        }
    }
}
</code></pre><p>Il est &#xE9;galement possible de modifier compl&#xE8;tement les Headers, ce qui &#xE9;crase toutes les autres valeurs de headers (&#xE0; l&apos;exception du <code>statusCode</code> donc). Mettre une valeur &#xE0; <code>false</code> retire le Headers pr&#xE9;c&#xE9;demment mis en place.</p><pre><code class="lang-json">{
    &quot;headers&quot;: {
        &quot;Content-Type&quot;: &quot;application/json; charset=utf-8&quot;,
        &quot;Access-Control-Allow-Origin&quot;: &quot;*&quot;
    },
    &quot;routes&quot;: {
        &quot;/api/articles&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;controller&quot;: &quot;blog/list-of-articles.js&quot;,
            &quot;statusCode&quot;: 203,
            &quot;headers&quot;: {
                &quot;Access-Control-Allow-Origin&quot;: false
            }
        }
    }
}
</code></pre><h3 id="configuration-dynamique">Configuration dynamique</h3><p>Plut&#xF4;t que d&apos;utiliser plusieurs configurations statique <code>.json</code>, il est tout a fait possible d&apos;utiliser des configurations dynamiques <code>.js</code>. Dans ce cas, ce que votre fichier <code>.js</code> devra retourner avec <code>module.exports</code> sera un objet JSON valide.</p><p>Nous pouvons ainsi ais&#xE9;ment remplacer les six fichiers suivants :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    &quot;languageCode&quot;: &quot;fr-fr&quot;,
    &quot;statics&quot;: &quot;statics.fr-fr.json&quot;
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p><em>webconfig.prod.json</em></p><pre><code class="lang-json">{
    &quot;cache&quot;: true,
    &quot;languageCode&quot;: &quot;fr-fr&quot;,
    &quot;statics&quot;: &quot;statics.fr-fr.json&quot;
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p><em>webconfig.en-us.json</em></p><pre><code class="lang-json">{
    &quot;languageCode&quot;: &quot;fr-fr&quot;,
    &quot;statics&quot;: &quot;statics.fr-fr.json&quot;
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p><em>webconfig.en-us.prod.json</em></p><pre><code class="lang-json">{
    &quot;cache&quot;: true,
    &quot;languageCode&quot;: &quot;en-us&quot;,
    &quot;statics&quot;: &quot;statics.en-us.json&quot;
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p><em>statics.fr-fr.json</em></p><pre><code class="lang-json">{
    &quot;/variations/&quot;: &quot;variations/fr-fr/&quot;,
}
</code></pre><p><em>statics.en-us.json</em></p><pre><code class="lang-json">{
    &quot;/variations/&quot;: &quot;variations/en-us/&quot;,
}
</code></pre><p>par les deux fichiers suivants :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">module.export = (function () {
    var webconfig = {
        &quot;cache&quot;: false,
        &quot;languageCode&quot;: &quot;fr-fr&quot;,
        &quot;statics&quot;: &quot;statics.json&quot;
        &quot;routes&quot;: {
            &quot;/&quot;: &quot;index.htm&quot;
        }
    };

    if (process.env.NODE_ENV === &apos;production&apos;) {
        webconfig[&quot;cache&quot;] = true;
    }

    if (process.env.LANG) {
        webconfig[&quot;languageCode&quot;] = process.env.LANG;
    }

    return webconfig;
}());
</code></pre><p><em>statics.json</em></p><pre><code class="lang-json">module.export = (function () {
    var NA = this.NA,
        languageCode = NA.webconfig.languageCode

    return {
        &quot;/variations/&quot;: &quot;variations/&quot; + languageCode + &quot;/&quot;,
    };
}());
</code></pre><p>en supposant les variables d&apos;environnements suivantes pour les quatre environnements suivants :</p><p>Local FR</p><pre><code class="lang-bash">NODE_ENV=DEVELOPMENT
LANG=fr-fr
</code></pre><p>Local EN</p><pre><code class="lang-bash">NODE_ENV=DEVELOPMENT
LANG=en-us
</code></pre><p>Prod FR</p><pre><code class="lang-bash">NODE_ENV=PRODUCTION
LANG=fr-fr
</code></pre><p>Prod EN</p><pre><code class="lang-bash">NODE_ENV=PRODUCTION
LANG=en-us
</code></pre><h3 id="faire-tourner-le-site-en-https">Faire tourner le site en HTTPs</h3><p>Il est tr&#xE8;s simple de faire tourner une instance de NodeAtlas avec le protocol HTTPs. Pour cela il suffit de cr&#xE9;er, par exemple un dossier <code>security</code> dans lequel vous allez placer vos fichiers <code>server.key</code> et <code>server.crt</code> afin d&apos;alimenter le protocol.</p><p>Il ne vous reste plus qu&apos;&#xE0; utiliser la configuration suivante :</p><pre><code class="lang-json">{
    &quot;httpSecure&quot;: true,
    &quot;httpSecureKeyRelativePath&quot;: &quot;security/server.key&quot;,
    &quot;httpSecureCertificateRelativePath&quot;: &quot;security/server.crt&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Vous pouvez &#xE9;galement, si &#x2014;comme c&apos;est le cas ici&#x2014; vos deux fichiers Key et Certificate portent le m&#xEA;me nom, utiliser cette configuration :</p><pre><code class="lang-json">{
    &quot;httpSecure&quot;: &quot;security/server&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Pour finir, il est &#xE9;galement possible de seulement laisser la valeur de <code>httpSecure</code> &#xE0; <code>true</code> pour obtenir un <code>https</code> dans vos chemins comme <code>urlBasePath</code> ou <code>urlBase</code>. Cependant le serveur ce lancera en HTTP, il vous faudra un proxy qui g&#xE8;re pour vous la lecture du certificat.</p><pre><code class="lang-json">{
    &quot;httpSecure&quot;: true,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><em>Note : en production, si vous redirigez un proxy vers votre instance de NodeAtlas, n&apos;oubliez pas qu&apos;en HTTPs ce n&apos;est pas <code>urlPort: 80</code> mais <code>urlPort: 443</code></em></p><h3 id="minifier-les-css-js">Minifier les CSS / JS</h3><p>Vous pouvez automatiquement g&#xE9;n&#xE9;rer des fichiers CSS et JS minifi&#xE9;s et offusqu&#xE9;s en cr&#xE9;ant des Bundles en r&#xE9;f&#xE9;ren&#xE7;ant les groupes de fichiers d&apos;entr&#xE9; par leur chemin d&apos;acc&#xE8;s et le chemin du fichier de sortie. Vous pouvez bien entendu en faire autant que vous le souhaitez. La g&#xE9;n&#xE9;ration des fichiers se fait &#xE0; chaque d&#xE9;marrage de NodeAtlas que ce soit en tant que serveur ou via la commande <code>--generate</code> pour peu qu&apos;un Bundle existe dans le Webconfig.</p><h4 id="cr-er-des-bundles">Cr&#xE9;er des Bundles</h4><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/boot.min.js&quot;: [
                &quot;javascripts/modernizr.js&quot;,
                &quot;javascripts/yepnot.js&quot;,
                &quot;javascripts/html5Shiv.js&quot;
            ],
            &quot;javascripts/framework.min.js&quot;: [
                &quot;javascripts/jquery.js&quot;,
                &quot;javascripts/jquery-ui.js&quot;,
                &quot;javascripts/prettify.js&quot;,
                &quot;javascripts/prettify/run_prettify.js&quot;
            ],
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/components/extended-format-date.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        },
        &quot;stylesheets&quot;: {
            &quot;stylesheets/common.min.css&quot;: [
                &quot;stylesheets/common.css&quot;,
                &quot;stylesheets/common-min780.css&quot;,
                &quot;stylesheets/common-min1160.css&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et l&apos;ensemble de fichier suivant :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x251C;&#x2500; stylesheets/
&#x2502;  &#x2502;  &#x251C;&#x2500; common.css
&#x2502;  &#x2502;  &#x251C;&#x2500; common-min780.css
&#x2502;  &#x2502;  &#x2514;&#x2500; common-min1160.css
&#x2502;  &#x2514;&#x2500; javascripts/
&#x2502;     &#x251C;&#x2500; modernizr.js
&#x2502;     &#x251C;&#x2500; yepnot.js
&#x2502;     &#x251C;&#x2500; html5Shiv.js
&#x2502;     &#x251C;&#x2500; jquery.js
&#x2502;     &#x251C;&#x2500; jquery-ui.js
&#x2502;     &#x251C;&#x2500; prettify.js
&#x2502;     &#x251C;&#x2500; prettify/
&#x2502;     &#x2502;  &#x2514;&#x2500; run_prettify.js
&#x2502;     &#x251C;&#x2500; components/
&#x2502;     &#x2502;  &#x2514;&#x2500; extended-format-date.js
&#x2502;     &#x2514;&#x2500; common.js
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>vous obtiendrez les nouveaux fichiers suivant :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x251C;&#x2500; stylesheets/
&#x2502;  &#x2502;  &#x251C;&#x2500; common.css
&#x2502;  &#x2502;  &#x251C;&#x2500; common-min780.css
&#x2502;  &#x2502;  &#x251C;&#x2500; common-min1160.css
&#x2502;  &#x2502;  &#x2514;&#x2500; common.min.css     &#x2906; nouveau fichier
&#x2502;  &#x2514;&#x2500; javascripts/
&#x2502;     &#x251C;&#x2500; modernizr.js
&#x2502;     &#x251C;&#x2500; yepnot.js
&#x2502;     &#x251C;&#x2500; html5Shiv.js
&#x2502;     &#x251C;&#x2500; jquery.js
&#x2502;     &#x251C;&#x2500; jquery-ui.js
&#x2502;     &#x251C;&#x2500; prettify.js
&#x2502;     &#x251C;&#x2500; prettify/
&#x2502;     &#x2502;  &#x2514;&#x2500; run_prettify.js
&#x2502;     &#x251C;&#x2500; components/
&#x2502;     &#x2502;  &#x2514;&#x2500; extended-format-date.js
&#x2502;     &#x251C;&#x2500; common.js
&#x2502;     &#x251C;&#x2500; boot.min.js        &#x2906; nouveau fichier
&#x2502;     &#x251C;&#x2500; framework.min.js   &#x2906; nouveau fichier
&#x2502;     &#x2514;&#x2500; common.min.js      &#x2906; nouveau fichier
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><h4 id="bundles-dans-un-fichier-partag-">Bundles dans un fichier partag&#xE9;</h4><p>Afin de ne pas r&#xE9;&#xE9;crire une longue liste de configuration de Bundles dans un fichier <code>webconfig.json</code> &#xE0; destination de votre environnement de d&#xE9;veloppement et <code>webconfig.prod.json</code> &#xE0; destination de votre environnement de production, vous pouvez mutualiser la d&#xE9;claration des fichiers dans un fichier de votre choix. Par convention, c&apos;est le fichier <code>bundles.json</code>.</p><p>Par exemple :</p><p>L&apos;ensemble de fichier suivant</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x251C;&#x2500; stylesheets/
&#x2502;  &#x2502;  &#x251C;&#x2500; common.css
&#x2502;  &#x2502;  &#x251C;&#x2500; common-min780.css
&#x2502;  &#x2502;  &#x2514;&#x2500; common-min1160.css
&#x2502;  &#x2514;&#x2500; javascripts/
&#x2502;     &#x251C;&#x2500; modernizr.js
&#x2502;     &#x251C;&#x2500; yepnot.js
&#x2502;     &#x251C;&#x2500; html5Shiv.js
&#x2502;     &#x251C;&#x2500; jquery.js
&#x2502;     &#x251C;&#x2500; jquery-ui.js
&#x2502;     &#x251C;&#x2500; prettify.js
&#x2502;     &#x251C;&#x2500; prettify/
&#x2502;     &#x2502;  &#x2514;&#x2500; run_prettify.js
&#x2502;     &#x251C;&#x2500; components/
&#x2502;     &#x2502;  &#x2514;&#x2500; extended-format-date.js
&#x2502;     &#x2514;&#x2500; common.js
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x251C;&#x2500; webconfig.json
&#x2514;&#x2500; webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/boot.min.js&quot;: [
                &quot;javascripts/modernizr.js&quot;,
                &quot;javascripts/yepnot.js&quot;,
                &quot;javascripts/html5Shiv.js&quot;
            ],
            &quot;javascripts/framework.min.js&quot;: [
                &quot;javascripts/jquery.js&quot;,
                &quot;javascripts/jquery-ui.js&quot;,
                &quot;javascripts/prettify.js&quot;,
                &quot;javascripts/prettify/run_prettify.js&quot;
            ],
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/components/extended-format-date.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        },
        &quot;stylesheets&quot;: {
            &quot;stylesheets/common.min.css&quot;: [
                &quot;stylesheets/common.css&quot;,
                &quot;stylesheets/common-min780.css&quot;,
                &quot;stylesheets/common-min1160.css&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7776,
    &quot;httpHostname&quot;: &quot;blog.lesieur.name&quot;,
    &quot;urlPort&quot;: 80,
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/boot.min.js&quot;: [
                &quot;javascripts/modernizr.js&quot;,
                &quot;javascripts/yepnot.js&quot;,
                &quot;javascripts/html5Shiv.js&quot;
            ],
            &quot;javascripts/framework.min.js&quot;: [
                &quot;javascripts/jquery.js&quot;,
                &quot;javascripts/jquery-ui.js&quot;,
                &quot;javascripts/prettify.js&quot;,
                &quot;javascripts/prettify/run_prettify.js&quot;
            ],
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/components/extended-format-date.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        },
        &quot;stylesheets&quot;: {
            &quot;stylesheets/common.min.css&quot;: [
                &quot;stylesheets/common.css&quot;,
                &quot;stylesheets/common-min780.css&quot;,
                &quot;stylesheets/common-min1160.css&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>pourrait devenir l&apos;ensemble de fichier suivant</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x251C;&#x2500; stylesheets/
&#x2502;  &#x2502;  &#x251C;&#x2500; common.css
&#x2502;  &#x2502;  &#x251C;&#x2500; common-min780.css
&#x2502;  &#x2502;  &#x2514;&#x2500; common-min1160.css
&#x2502;  &#x2514;&#x2500; javascripts/
&#x2502;     &#x251C;&#x2500; modernizr.js
&#x2502;     &#x251C;&#x2500; yepnot.js
&#x2502;     &#x251C;&#x2500; html5Shiv.js
&#x2502;     &#x251C;&#x2500; jquery.js
&#x2502;     &#x251C;&#x2500; jquery-ui.js
&#x2502;     &#x251C;&#x2500; prettify.js
&#x2502;     &#x251C;&#x2500; prettify/
&#x2502;     &#x2502;  &#x2514;&#x2500; run_prettify.js
&#x2502;     &#x251C;&#x2500; components/
&#x2502;     &#x2502;  &#x2514;&#x2500; extended-format-date.js
&#x2502;     &#x2514;&#x2500; common.js
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x251C;&#x2500; bundles.json              &#x2906; nouveau fichier
&#x251C;&#x2500; webconfig.json
&#x2514;&#x2500; webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;bundles&quot;: &quot;bundles.json&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7776,
    &quot;httpHostname&quot;: &quot;blog.lesieur.name&quot;,
    &quot;urlPort&quot;: 80,
    &quot;bundles&quot;: &quot;bundles.json&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et <code>bundles.json</code></p><pre><code class="lang-json">{
    &quot;javascripts&quot;: {
        &quot;javascripts/boot.min.js&quot;: [
            &quot;javascripts/modernizr.js&quot;,
            &quot;javascripts/yepnot.js&quot;,
            &quot;javascripts/html5Shiv.js&quot;
        ],
        &quot;javascripts/framework.min.js&quot;: [
            &quot;javascripts/jquery.js&quot;,
            &quot;javascripts/jquery-ui.js&quot;,
            &quot;javascripts/prettify.js&quot;,
            &quot;javascripts/prettify/run_prettify.js&quot;
        ],
        &quot;javascripts/common.min.js&quot;: [
            &quot;javascripts/components/extended-format-date.js&quot;,
            &quot;javascripts/common.js&quot;
        ]
    },
    &quot;stylesheets&quot;: {
        &quot;stylesheets/common.min.css&quot;: [
            &quot;stylesheets/common.css&quot;,
            &quot;stylesheets/common-min780.css&quot;,
            &quot;stylesheets/common-min1160.css&quot;
        ]
    }
}
</code></pre><p><em>Note : il est possible de d&#xE9;sactiver les Bundles en ne les incluant pas dans le <code>webconfig</code> en question.</em></p><h4 id="d-sactiver-des-bundles">D&#xE9;sactiver des Bundles</h4><p>Il est &#xE9;galement possible de ne pas ex&#xE9;cuter la minification au d&#xE9;marrage d&apos;un site web avec NodeAtlas avec les propri&#xE9;t&#xE9;s <code>&quot;cssBundlingEnable&quot;: false</code> et <code>&quot;jsBundlingEnable&quot;: false</code> pour chaque type de Bundle.</p><pre><code class="lang-json">{
    &quot;cssBundlingEnable&quot;: false,
    &quot;jsBundlingEnable&quot;: false,
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/boot.min.js&quot;: [
                &quot;javascripts/modernizr.js&quot;,
                &quot;javascripts/yepnot.js&quot;,
                &quot;javascripts/html5Shiv.js&quot;
            ],
            &quot;javascripts/framework.min.js&quot;: [
                &quot;javascripts/jquery.js&quot;,
                &quot;javascripts/jquery-ui.js&quot;,
                &quot;javascripts/prettify.js&quot;,
                &quot;javascripts/prettify/run_prettify.js&quot;
            ],
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/components/extended-format-date.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        },
        &quot;stylesheets&quot;: {
            &quot;stylesheets/common.min.css&quot;: [
                &quot;stylesheets/common.css&quot;,
                &quot;stylesheets/common-min780.css&quot;,
                &quot;stylesheets/common-min1160.css&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><em>Note : si vos bundles sont dans un fichier partag&#xE9;, vous pouvez &#xE9;galement les d&#xE9;sactiver simplement en retirand la ligne <code>&quot;bundles&quot;: &quot;bundles.json&quot;</code>.</em></p><h4 id="r-g-n-rer-les-bundles-avant-chaque-rendu-de-page">R&#xE9;-g&#xE9;n&#xE9;rer les Bundles avant chaque rendu de page</h4><p>De mani&#xE8;re &#xE0; toujours tester vos page avec les fichiers minifi&#xE9;s, vous pouvez demander &#xE0; ce qu&apos;ils soient r&#xE9;g&#xE9;n&#xE9;r&#xE9;s avant chaque affichage de page avec les propri&#xE9;t&#xE9;s <code>&quot;cssBundlingBeforeResponse&quot;: true</code> et <code>&quot;jsBundlingBeforeResponse&quot;: true</code> pour chaque type de Bundle.</p><pre><code class="lang-json">{
    &quot;cssBundlingBeforeResponse&quot;: false,
    &quot;jsBundlingBeforeResponse&quot;: false,
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/boot.min.js&quot;: [
                &quot;javascripts/modernizr.js&quot;,
                &quot;javascripts/yepnot.js&quot;,
                &quot;javascripts/html5Shiv.js&quot;
            ],
            &quot;javascripts/framework.min.js&quot;: [
                &quot;javascripts/jquery.js&quot;,
                &quot;javascripts/jquery-ui.js&quot;,
                &quot;javascripts/prettify.js&quot;,
                &quot;javascripts/prettify/run_prettify.js&quot;
            ],
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/components/extended-format-date.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        },
        &quot;stylesheets&quot;: {
            &quot;stylesheets/common.min.css&quot;: [
                &quot;stylesheets/common.css&quot;,
                &quot;stylesheets/common-min780.css&quot;,
                &quot;stylesheets/common-min1160.css&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><em>Note : ceci n&apos;est pas conseill&#xE9; en production car cela ralenti les r&#xE9;ponses des pages.</em></p><h4 id="version-dans-noms-de-fichiers-g-n-r-s">Version dans noms de fichiers g&#xE9;n&#xE9;r&#xE9;s</h4><p>Afin de forcer le navigateur &#xE0; charger de nouveau vos fichiers en cache il est int&#xE9;ressant de changer leur nom pour chaque version. Ainsi avec l&apos;occurence <code>{version}</code> sera remplac&#xE9; par le num&#xE9;ro de version de votre site actuel (par d&#xE9;faut <code>0.0.0</code>).</p><p>Ainsi, si vous avez un fichier <code>package.json</code> ou un <code>webconfig.json</code> valide avec un num&#xE9;ro de version indiqu&#xE9; sous la propri&#xE9;t&#xE9; version, ce num&#xE9;ro remplacera la valeur <code>{version}</code>. Ainsi avec le webconfig suivant :</p><p><em>webconfig</em></p><pre><code class="lang-js">{
    &quot;version&quot;: &quot;1.0.0&quot;,
    &quot;bundles&quot;: &quot;bundles.json&quot;
    &quot;routes&quot;: &quot;routes.json&quot;
}
</code></pre><p>et les bundles suivants :</p><p><em>bundles.json</em></p><pre><code class="lang-json">{
    &quot;javascripts&quot;: {
        &quot;javascripts/boot.{version}.min.js&quot;: [
            &quot;javascripts/modernizr.js&quot;,
            &quot;javascripts/yepnot.js&quot;,
            &quot;javascripts/html5Shiv.js&quot;
        ]
    },
    &quot;stylesheets&quot;: {
        &quot;stylesheets/common.{version}.min.css&quot;: [
            &quot;stylesheets/common.css&quot;,
            &quot;stylesheets/common-min780.css&quot;,
            &quot;stylesheets/common-min1160.css&quot;
        ]
    }
}
</code></pre><p>vous obtiendrez les fichiers <code>assets/javascripts/boot.1.0.0.min.js</code> et <code>assets/javascripts/common.1.0.0.min.css</code>.</p><p>que vous pourrez appeler ainsi :</p><p><em>views/*.htm</em></p><pre><code class="lang-htm">&lt;!-- ... --&gt;

&lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/common.&lt;?= webconfig.version ?&gt;.min.css&quot;&gt;

&lt;!-- ... --&gt;

&lt;script src=&quot;javascripts/boot.&lt;?= webconfig.version ?&gt;.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- ... --&gt;
</code></pre><h4 id="bundles-avec-sockets">Bundles avec Sockets</h4><p>Il est possible de minifier le fichier d&#xE9;fini par <code>NA.webconfig.socketClientFile</code> m&#xEA;me si celui-ci n&apos;existe pas physiquement. Il suffit pour cela de le glisser dans les bundles souhait&#xE9;.</p><p>Dans l&apos;exemple suivant, le fichier virtuel <code>node-atlas/socket.io.js</code> sera ajout&#xE9; aux sources avec la bonne configuration pour faire le lien client/serveur.</p><pre><code class="lang-json">{
    &quot;bundles&quot;: {
        &quot;javascripts&quot;: {
            &quot;javascripts/common.min.js&quot;: [
                &quot;javascripts/socket.io.js&quot;,
                &quot;node-atlas/socket.io.js&quot;,
                &quot;javascripts/common.js&quot;
            ]
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><h3 id="generer-les-css-avec-less">G&#xE9;n&#xE9;rer les CSS avec Less</h3><p>Vous pouvez utiliser le pr&#xE9;processeur Less pour cr&#xE9;er vos CSS. Le fonctionnement est le suivant : &#xE0; chaque fois qu&apos;une requ&#xEA;te CSS est effectu&#xE9;e, si un &#xE9;quivalent Less existe il est lu et celui-ci g&#xE9;n&#xE8;re le CSS. Une fois l&apos;op&#xE9;ration effectu&#xE9;e, on renvoi le CSS demand&#xE9;e.</p><p>Avec la structure suivante :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; stylesheets
&#x2502;     &#x2514;&#x2500; common.less
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>ainsi que le webconfig suivante :</p><pre><code class="lang-json">{
    &quot;less&quot;: true,
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>et le contenu suivant dans :</p><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;Less Test&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/common.css&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;This line is red.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>assets/stylesheets/common.less</em></p><pre><code class="lang-css">p {
    color: #f00;
}
</code></pre><p>vous g&#xE9;n&#xE9;rerez le fichier <code>assets/stylesheets/common.css</code> en appelant l&apos;url <code>http://localhost/</code> ou <code>http://localhost/stylesheets/common.css</code>.</p><h4 id="source-map-minification-et-autoprefix">Source Map, Minification et Autoprefix</h4><p>Par d&#xE9;faut, dans l&apos;exemple ci-dessus un fichier <code>common.css.map</code> sera g&#xE9;n&#xE9;r&#xE9;. Celui-ci permet &#xE0; votre navigateur de vous indiquer qu&apos;elle ligne du fichier <code>.less</code> a g&#xE9;n&#xE9;r&#xE9;e la propri&#xE9;t&#xE9; CSS de l&apos;&#xE9;l&#xE9;ment que vous avez s&#xE9;lectionn&#xE9; dans votre d&#xE9;buggeur.</p><p>Cela se d&#xE9;sactive avec <code>less.sourceMap</code> &#xE0; <code>false</code> :</p><pre><code class="lang-json">    &quot;less&quot;: {
        &quot;sourceMap&quot;: false
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><p>Vous pouvez &#xE9;galement g&#xE9;n&#xE9;rer des fichiers CSS d&#xE9;j&#xE0; minifi&#xE9;s avec :</p><pre><code class="lang-json">    &quot;less&quot;: {
        &quot;compress&quot;: true
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><p>Pour finir, vous pouvez &#xE9;galement ajouter automatiquement les prefix vendeur comme <code>--webkit</code>, <code>--moz</code>, <code>--ms</code>, <code>--o</code> lors de la g&#xE9;n&#xE9;ration sans vous en pr&#xE9;occuper dans vos sources !</p><pre><code class="lang-json">    &quot;less&quot;: {
        &quot;autoprefix&quot;: true
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><h4 id="compiler-les-less-avec-generate-">Compiler les Less avec <code>--generate</code></h4><p>Comme les Less sont compil&#xE9;s a la vol&#xE9;, quand le fichier est demand&#xE9; en http(s), toutes modifications dans le Less demandera de faire tourner le site pour la r&#xE9;percuter dans le CSS. Ensuite seulement vous pourrez minifier vos CSS. Il est possible d&apos;automatiser cette t&#xE2;che pour ne pas avoir &#xE0; d&#xE9;marrer le site gr&#xE2;ce &#xE0; <code>less.files</code>.</p><p>Avec le <code>webconfig.json</code> suivant :</p><pre><code class="lang-json">{
    &quot;less&quot;: {
        &quot;files&quot;: [
            &quot;stylesheets/common.less&quot;,
            &quot;stylesheets/component-1.less&quot;,
            &quot;stylesheets/component-2.less&quot;,
            &quot;stylesheets/component-3.less&quot;
        ]
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>ou suivante :</p><pre><code class="lang-json">{
    &quot;less&quot;: {
        &quot;files&quot;: &quot;less.json&quot;
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>avec <code>less.json</code> qui contient :</p><pre><code class="lang-json">[
    &quot;stylesheets/common.less&quot;,
    &quot;stylesheets/component-1.less&quot;,
    &quot;stylesheets/component-2.less&quot;,
    &quot;stylesheets/component-3.less&quot;
]
</code></pre><p>Par d&#xE9;faut, les <code>@import</code> utilis&#xE9;s par Less seront capable de fouiller dans les sous dossier : <code>styles</code>, <code>stylesheets</code> ou <code>css</code>. Il est possible de changer cela avec :</p><pre><code class="lang-json">{
    &quot;less&quot;: {
        &quot;paths&quot;: [
            &quot;subdirectory/styles-files&quot;,
        ],
        &quot;files&quot;: &quot;less.json&quot;
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><h3 id="generer-les-css-avec-stylus">G&#xE9;n&#xE9;rer les CSS avec Stylus</h3><p>Vous pouvez utiliser le pr&#xE9;processeur Stylus pour cr&#xE9;er vos CSS. Le fonctionnement est le suivant : &#xE0; chaque fois qu&apos;une requ&#xEA;te CSS est effectu&#xE9;e, si un &#xE9;quivalent Stylus existe il est lu et celui-ci g&#xE9;n&#xE8;re le CSS. Une fois l&apos;op&#xE9;ration effectu&#xE9;e, on renvoi le CSS demand&#xE9;e.</p><p>Avec la structure suivante :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; stylesheets
&#x2502;     &#x2514;&#x2500; common.styl
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>ainsi que le webconfig suivante :</p><pre><code class="lang-json">{
    &quot;stylus&quot;: true,
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>et le contenu suivant dans :</p><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;Stylus Test&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/common.css&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;This line is red.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>assets/stylesheets/common.styl</em></p><pre><code class="lang-css">p
    color: #f00
</code></pre><p>vous g&#xE9;n&#xE9;rerez le fichier <code>assets/stylesheets/common.css</code> en appelant l&apos;url <code>http://localhost/</code> ou <code>http://localhost/stylesheets/common.css</code>.</p><h4 id="source-map-minification-et-autoprefix">Source Map, Minification et Autoprefix</h4><p>Par d&#xE9;faut, dans l&apos;exemple ci-dessus un fichier <code>common.css.map</code> sera g&#xE9;n&#xE9;r&#xE9;. Celui-ci permet &#xE0; votre navigateur de vous indiquer qu&apos;elle ligne du fichier <code>.styl</code> a g&#xE9;n&#xE9;r&#xE9;e la propri&#xE9;t&#xE9; CSS de l&apos;&#xE9;l&#xE9;ment que vous avez s&#xE9;lectionn&#xE9; dans votre d&#xE9;buggeur.</p><p>Cela se d&#xE9;sactive avec <code>stylus.sourceMap</code> &#xE0; <code>false</code> :</p><pre><code class="lang-json">    &quot;stylus&quot;: {
        &quot;sourceMap&quot;: false
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><p>Vous pouvez &#xE9;galement g&#xE9;n&#xE9;rer des fichiers CSS d&#xE9;j&#xE0; minifi&#xE9;s avec :</p><pre><code class="lang-json">    &quot;stylus&quot;: {
        &quot;compress&quot;: true
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><p>Pour finir, vous pouvez &#xE9;galement ajouter automatiquement les prefix vendeur comme <code>--webkit</code>, <code>--moz</code>, <code>--ms</code>, <code>--o</code> lors de la g&#xE9;n&#xE9;ration sans vous en pr&#xE9;occuper dans vos sources !</p><pre><code class="lang-json">    &quot;stylus&quot;: {
        &quot;autoprefix&quot;: true
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
</code></pre><p><em>Note:</em> Plus d&apos;options sur <a href="https://www.npmjs.com/package/stylus">la documentation du module stylus</a>.</p><h4 id="compiler-les-stylus-avec-generate-">Compiler les Stylus avec <code>--generate</code></h4><p>Comme les Stylus sont compil&#xE9;s a la vol&#xE9;, quand le fichier est demand&#xE9; en http(s), toutes modifications dans le Stylus demandera de faire tourner le site pour la r&#xE9;percuter dans le CSS. Ensuite seulement vous pourrez minifier vos CSS. Il est possible d&apos;automatiser cette t&#xE2;che pour ne pas avoir &#xE0; d&#xE9;marrer le site gr&#xE2;ce &#xE0; <code>stylus.files</code>.</p><p>Avec le <code>webconfig.json</code> suivant :</p><pre><code class="lang-json">{
    &quot;stylus&quot;: {
        &quot;files&quot;: [
            &quot;stylesheets/common.styl&quot;,
            &quot;stylesheets/component-1.styl&quot;,
            &quot;stylesheets/component-2.styl&quot;,
            &quot;stylesheets/component-3.styl&quot;
        ]
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>ou suivante :</p><pre><code class="lang-json">{
    &quot;stylus&quot;: {
        &quot;files&quot;: &quot;stylus.json&quot;
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>avec <code>stylus.json</code> qui contient :</p><pre><code class="lang-json">[
    &quot;stylesheets/common.styl&quot;,
    &quot;stylesheets/component-1.styl&quot;,
    &quot;stylesheets/component-2.styl&quot;,
    &quot;stylesheets/component-3.styl&quot;
]
</code></pre><p>Par d&#xE9;faut, les <code>@import</code> utilis&#xE9;s par Stylus seront capable de fouiller dans les sous dossier : <code>styles</code>, <code>stylesheets</code> ou <code>css</code>. Il est possible de changer cela avec :</p><pre><code class="lang-json">{
    &quot;stylus&quot;: {
        &quot;paths&quot;: [
            &quot;subdirectory/styles-files&quot;,
        ],
        &quot;files&quot;: &quot;stylus.json&quot;
    },
    &quot;routes&quot;: {
        &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><h3 id="optimiser-les-images">Optimiser les Images</h3><p>Vous pouvez automatiquement optimiser les images que vous allez utiliser dans votre site pour en limiter le poids de chargement en cr&#xE9;ant des Optimizations en r&#xE9;f&#xE9;ren&#xE7;ant les fichiers d&apos;entr&#xE9;s par leur chemin d&apos;acc&#xE8;s et le chemin du dossier de sortie. Vous pouvez bien entendu en faire autant que vous le souhaitez. L&apos;optimisation des images se fait &#xE0; chaque d&#xE9;marrage de NodeAtlas que ce soit en tant que serveur ou via la commande <code>--generate</code> pour peu que des Optimizations existe dans le Webconfig.</p><h4 id="cr-er-des-optimizations">Cr&#xE9;er des Optimizations</h4><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et l&apos;ensemble de fichier suivant :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; media/
&#x2502;     &#x2514;&#x2500; images/
&#x2502;        &#x251C;&#x2500; example.png
&#x2502;        &#x251C;&#x2500; example.jpg
&#x2502;        &#x251C;&#x2500; example.gif
&#x2502;        &#x2514;&#x2500; example.svg
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>vous obtiendrez les nouveaux fichiers suivant :</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; media/
&#x2502;     &#x2514;&#x2500; images/
&#x2502;        &#x251C;&#x2500; example.png
&#x2502;        &#x251C;&#x2500; example.jpg
&#x2502;        &#x251C;&#x2500; example.gif
&#x2502;        &#x251C;&#x2500; example.svg
&#x2502;        &#x2514;&#x2500; optimized/       &#x2906; nouveau dossier
&#x2502;           &#x251C;&#x2500; example.png   &#x2906; nouveau fichier
&#x2502;           &#x251C;&#x2500; example.jpg   &#x2906; nouveau fichier
&#x2502;           &#x251C;&#x2500; example.gif   &#x2906; nouveau fichier
&#x2502;           &#x2514;&#x2500; example.svg   &#x2906; nouveau fichier
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x2514;&#x2500; webconfig.json
</code></pre><h4 id="cr-er-des-optimizations-par-groupes-de-fichier">Cr&#xE9;er des Optimizations par groupes de fichier</h4><p>Vous pouvez par exemple, plut&#xF4;t que d&apos;indiquer les fichiers un par un, les indiquer en groupe :</p><pre><code class="lang-json">{
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/*.{gif,jpg,png,svg}&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><h4 id="ajouter-des-options-aux-optimizations">Ajouter des options aux Optimizations</h4><p>Il est possible de red&#xE9;finir les options par d&#xE9;faut pour l&apos;optimisation via ses 4 objets :</p><pre><code class="lang-json">{
    &quot;optimizations&quot;: {
        &quot;jpg&quot;: { &quot;progressive&quot;: false },
        &quot;gif&quot;: { &quot;interlaced&quot;: false },
        &quot;png&quot;: { &quot;optimizationLevel&quot;: 1 },
        &quot;svg&quot;: { &quot;multipass&quot;: false },
        &quot;images&quot;: {
            &quot;media/images/*.{gif,jpg,png,svg}&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>Pour conna&#xEE;tre toutes les options c&apos;est par ici :</p><ul>
<li><a href="https://www.npmjs.com/package/imagemin-jpegtran">Options Jpeg</a></li>
<li><a href="https://www.npmjs.com/package/imagemin-gifsicle">Options Gif</a></li>
<li><a href="https://www.npmjs.com/package/imagemin-optipng">Options Png</a></li>
<li><a href="https://www.npmjs.com/package/imagemin-svgo">Options Svg</a></li>
</ul><h4 id="optimizations-dans-un-fichier-partag-">Optimizations dans un fichier partag&#xE9;</h4><p>Afin de ne pas r&#xE9;&#xE9;crire une longue liste de configuration d&apos;Optimizations dans un fichier <code>webconfig.json</code> &#xE0; destination de votre environnement de d&#xE9;veloppement et <code>webconfig.prod.json</code> &#xE0; destination de votre environnement de production, vous pouvez mutualiser la d&#xE9;claration des fichiers dans un fichier de votre choix. Par convention, c&apos;est le fichier <code>optimizations.json</code>.</p><p>Par exemple :</p><p>L&apos;ensemble de fichier suivant</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; media/
&#x2502;     &#x2514;&#x2500; images/
&#x2502;        &#x251C;&#x2500; example.png
&#x2502;        &#x251C;&#x2500; example.jpg
&#x2502;        &#x251C;&#x2500; example.gif
&#x2502;        &#x2514;&#x2500; example.svg
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x251C;&#x2500; webconfig.json
&#x2514;&#x2500; webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7776,
    &quot;httpHostname&quot;: &quot;blog.lesieur.name&quot;,
    &quot;urlPort&quot;: 80,
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>pourrait devenir l&apos;ensemble de fichier suivant</p><pre><code>&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; media/
&#x2502;     &#x2514;&#x2500; images/
&#x2502;        &#x251C;&#x2500; example.png
&#x2502;        &#x251C;&#x2500; example.jpg
&#x2502;        &#x251C;&#x2500; example.gif
&#x2502;        &#x2514;&#x2500; example.svg
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; index.htm
&#x251C;&#x2500; bundles.json
&#x251C;&#x2500; webconfig.json
&#x2514;&#x2500; webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;optimizations&quot;: &quot;optimizations.json&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7776,
    &quot;httpHostname&quot;: &quot;blog.lesieur.name&quot;,
    &quot;urlPort&quot;: 80,
    &quot;optimizations&quot;: &quot;optimizations.json&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p>et <code>optimizations.json</code></p><pre><code class="lang-json">{
    &quot;images&quot;: {
        &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
        &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
        &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
        &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
    }
}
</code></pre><p><em>Note : il est possible de d&#xE9;sactiver les Optimizations en ne les incluant pas dans le <code>webconfig</code> en question.</em></p><h4 id="d-sactiver-des-optimizations">D&#xE9;sactiver des Optimizations</h4><p>Il est &#xE9;galement possible de ne pas ex&#xE9;cuter l&apos;optimisation au d&#xE9;marrage d&apos;un site web avec NodeAtlas avec les propri&#xE9;t&#xE9;s <code>&quot;imgOptimizationsEnable&quot;: false</code>.</p><pre><code class="lang-json">{
    &quot;imgOptimizationsEnable&quot;: false,
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><em>Note : si vos optimizations sont dans un fichier partag&#xE9;, vous pouvez &#xE9;galement les d&#xE9;sactiver simplement en retirant la ligne <code>&quot;optimizations&quot;: &quot;optimizations.json&quot;</code>.</em></p><h4 id="r-g-n-rer-les-optimizations-avant-chaque-rendu-de-page">R&#xE9;-g&#xE9;n&#xE9;rer les Optimizations avant chaque rendu de page</h4><p>Vous pouvez demander &#xE0; ce que les fichiers soient r&#xE9;g&#xE9;n&#xE9;r&#xE9;s avant chaque affichage de page avec les propri&#xE9;t&#xE9;s <code>&quot;imgOptimizationsBeforeResponse&quot;: true</code>.</p><pre><code class="lang-json">{
    &quot;imgOptimizationsBeforeResponse&quot;: false,
    &quot;optimizations&quot;: {
        &quot;images&quot;: {
            &quot;media/images/example.png&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.jpg&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.gif&quot;: &quot;media/images/optimized/&quot;,
            &quot;media/images/example.svg&quot;: &quot;media/images/optimized/&quot;
        }
    },
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><em>Note : ceci n&apos;est pas conseill&#xE9; en production car cela ralenti les r&#xE9;ponses des pages.</em></p><h3 id="injecter-du-css-inline-pour-maintenir-des-assets-email">Injecter du CSS inline pour maintenir des assets Email</h3><p>Quand on cr&#xE9;er des templates pour envoyer des Newsletters par email, ou m&#xEA;me de simple message, on ne peut pas attacher de feuille de style. Le seul moyen &#xE0; notre disposition est d&apos;&#xE9;crire les instructions CSS dans le template &#xE0; l&apos;int&#xE9;rieur de l&apos;attribut <code>style</code> brisant ainsi la s&#xE9;paration du font et de la forme.</p><h4 id="injection-sp-cifique">Injection sp&#xE9;cifique</h4><p>Avec <code>injectCss</code>, il vous suffit d&apos;habiller votre template comme &#xE0; votre habitude via une feuille de style et NodeAtlas injectera &#xE0; chaque rendu les styles dans l&apos;attribut <code>style</code>. Il ne vous restera plus qu&apos;&#xE0; g&#xE9;n&#xE9;rer vos templates.</p><p>Avec par exemple la configuration suivante :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;email.htm&quot;,
            &quot;output&quot;: &quot;bienvenue.html&quot;,
            &quot;injectCss&quot;: &quot;stylesheets/email.css&quot;
        }
    }
}
</code></pre><p>et l&apos;ensemble de fichiers suivant :</p><pre><code>&#x251C;&#x2500; serverless/
&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; stylesheets/
&#x2502;     &#x2514;&#x2500; email.css
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; email.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>dont les contenus sont :</p><p><em>stylesheets/common.css</em></p><pre><code class="lang-css">body {
    color: #f00;
}
</code></pre><p><em>views/email.htm*</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;Email&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;This is a template email.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>vous obtiendrez en sortie avec la commande <code>node-atlas --generate</code> l&apos;ensemble de fichier suivant :</p><pre><code>&#x251C;&#x2500; serverless/
&#x2502;  &#x2514;&#x2500; bienvenue.html    &lt;= template email pr&#xEA;t &#xE0; l&apos;envoi !
&#x251C;&#x2500; assets/
&#x2502;  &#x2514;&#x2500; stylesheets/
&#x2502;     &#x2514;&#x2500; email.css
&#x251C;&#x2500; views/
&#x2502;  &#x2514;&#x2500; email.htm
&#x2514;&#x2500; webconfig.json
</code></pre><p>avec comme contenu pour <code>serverless/bienvenue.html</code></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;Email&lt;/title&gt;
    &lt;/head&gt;
    &lt;body style=&quot;color: #f00;&quot;&gt;
        &lt;p&gt;This is a template email.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Ce m&#xE9;canisme marche &#xE9;galement si vous n&apos;avez pas l&apos;intention de g&#xE9;n&#xE9;rer quoi que ce soit mais sur un site qui tourne. Pratique pour modifier vos maquettes en live avant de les g&#xE9;n&#xE9;rer.</p><blockquote>
<p>Test : Depuis <code>./tests/examples/css-injection</code> lancez <code>node &quot;../../../&quot; --generate</code>. Le r&#xE9;sultat est dans <code>serverless</code>.</p>
</blockquote><h4 id="injection-globale">Injection globale</h4><p>Il existe &#xE9;galement la m&#xEA;me propri&#xE9;t&#xE9; globale impactant toutes les pages.</p><pre><code class="lang-json">{
    &quot;injectCss&quot;: &quot;stylesheets/email.css&quot;,
    &quot;routes&quot;: {
        &quot;/bienvenue/&quot;: {
            &quot;view&quot;: &quot;email-a.htm&quot;,
            &quot;generate&quot;: &quot;bienvenue.html&quot;
        },
        &quot;/au-revoir/&quot;: {
            &quot;view&quot;: &quot;email-b.htm&quot;,
            &quot;generate&quot;: &quot;au-revoir.html&quot;
        }
    }
}
</code></pre><p>ainsi les deux pages <code>bienvenue</code> et <code>au-revoir</code> contiendront chacune <code>&lt;body style=&quot;color: #f00;&quot;&gt;</code>.</p><h4 id="injection-multiple">Injection multiple</h4><p>Il est possible :</p><ul>
<li>De pr&#xE9;ciser des feuilles sp&#xE9;cifique et commune en m&#xEA;me temps.</li>
<li>De pr&#xE9;ciser plus d&apos;une feuille &#xE0; la fois.</li>
</ul><pre><code class="lang-json">{
    &quot;injectCss&quot;: [&quot;stylesheets/reset.css&quot;, &quot;stylesheets/email.css&quot;],
    &quot;routes&quot;: {
        &quot;/bienvenue/&quot;: {
            &quot;view&quot;: &quot;email-a.htm&quot;,
            &quot;generate&quot;: &quot;bienvenue.html&quot;,
            &quot;injectCss&quot;: &quot;/stylesheets/welcome.css&quot;
        },
        &quot;/au-revoir/&quot;: {
            &quot;view&quot;: &quot;email-b.htm&quot;,
            &quot;generate&quot;: &quot;au-revoir.html&quot;,
            &quot;injectCss&quot;: [&quot;stylesheets/good-bye.css&quot;, &quot;/stylesheets/others.css&quot;]
        }
    }
}
</code></pre><blockquote>
<p>Test : Depuis <code>./tests/examples/css-injection</code> lancez <code>node &quot;../../../&quot; --generate --webconfig webconfig.multiple.json</code>. Le r&#xE9;sultat est dans <code>serverless</code>.</p>
</blockquote><h3 id="autoriser-interdire-les-demandes-get-post">Autoriser / Interdire les demandes GET / POST</h3><p>Vous pouvez &#xE9;galement manager la mani&#xE8;re dont le serveur va r&#xE9;pondre aux demandes GET/POST pour une page donn&#xE9;e. Par exemple, nous allons autoriser l&apos;acc&#xE8;s aux pages uniquement en GET pour tout le site et autoriser un POST pour une page seulement (et m&#xEA;me lui interdire le GET).</p><pre><code class="lang-json">{
    &quot;get&quot;: true,
    &quot;post&quot;: false,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;/liste-des-membres/&quot;: {
            &quot;view&quot;: &quot;members.htm&quot;
        },
        &quot;/rediger-commentaire/&quot;: {
            &quot;view&quot;: &quot;write-com.htm&quot;
        },
        &quot;/commentaire-sauvegarde/&quot;: {
            &quot;view&quot;: &quot;save-com.htm&quot;,
            &quot;get&quot;: false,
            &quot;post&quot;: true
        }
    }
}
</code></pre><p><em>Note : Si rien n&apos;est pr&#xE9;cis&#xE9;,</em> <code>get</code> <em>et</em> <code>post</code> <em>sont &#xE0;</em> <code>true</code> <em>au niveau global et par page.</em></p><h3 id="autoriser-interdire-les-demandes-put-delete">Autoriser / Interdire les demandes PUT / DELETE</h3><p>Fonctionnant exactement de la m&#xEA;me mani&#xE8;re que <code>get</code> et <code>post</code>, les deux actions HTTP PUT et DELETE qui part d&#xE9;faut ne sont pas activ&#xE9; peuvent &#xEA;tre activ&#xE9; avec <code>put</code> et <code>delete</code>.</p><pre><code class="lang-json">{
    &quot;get&quot;: false,
    &quot;post&quot;: false,
    &quot;put&quot;: true,
    &quot;routes&quot;: {
        &quot;/read-all-entry/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;all-entry.json&quot;,
            &quot;get&quot;: true,
            &quot;put&quot;: false
        },
        &quot;/read-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;,
            &quot;get&quot;: true,
            &quot;put&quot;: false
        },
        &quot;/create-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;,
            &quot;post&quot;: true,
            &quot;put&quot;: false
        },
        &quot;/update-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;
        },
        &quot;/delete-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;,
            &quot;delete&quot;: true,
            &quot;put&quot;: false
        }
    }
}
</code></pre><p>Avec la configuration ci-dessus, seulement une action HTTP n&apos;est possible par entr&#xE9;e, cela permet de faire des APIs REST facilement avec NodeAtlas.</p><h3 id="gerer-cors-et-les-demandes-options">G&#xE9;r&#xE9;r CORS et les demandes OPTIONS</h3><p>Par d&#xE9;faut, les requ&#xEA;tes pr&#xE9;-v&#xE9;rifi&#xE9;es (&quot;preflighted requests&quot;) ne sont pas activ&#xE9;es. Vous allez en avoir besoin pour, par exemple, effectuer des requ&#xEA;tes Cross-Domain ou CORS. Les requ&#xEA;tes pr&#xE9;-v&#xE9;rifi&#xE9;es se font avec la m&#xE9;thode HTTP OPTIONS.</p><p>Pour activer OPTIONS sur une route, utilisez la propri&#xE9;t&#xE9; <code>options</code> sur une route dans le webconfig. Pour activer OPTIONS sur toutes les routes, utilisez alors la propri&#xE9;t&#xE9; options du webconfig sur la configuration global.</p><pre><code class="lang-json">{
    &quot;options&quot;: true,
    &quot;routes&quot;: {
        &quot;/read-all-entry/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;all-entry.json&quot;,
            &quot;options&quot;: false
        },
        &quot;/create-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;,
            &quot;post&quot;: true
        },
        &quot;/delete-entry/:id/&quot;: {
            &quot;view&quot;: &quot;display-json.htm&quot;,
            &quot;variation&quot;: &quot;entry.json&quot;,
            &quot;delete&quot;: true
        }
    }
}
</code></pre><p><strong>Demande Cross-Domain</strong></p><p>Si vous souhaitez authoriser une ressource du serveur NodeAtlas au requ&#xEA;te en provenance de <code>www.domain-a.com</code> pour une page pr&#xE9;cise, vous pouvez le faire ainsi :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/api/random-quote&quot;: {
            &quot;controller&quot;: &quot;get-quote.js&quot;,
            &quot;headers&quot;: {
                &quot;Access-Control-Allow-Origin&quot;: &quot;http://www.domain-a.com&quot;
            }
        }
    }
}
</code></pre><p>Ainsi vous pourrez par exemple accepter la requ&#xEA;te suivante qui a pour <code>Origin</code>, <code>http://www.domain-a.com</code> qui est donc une valeur de <code>Access-Control-Allow-Origin</code> :</p><pre><code class="lang-bash">GET /api/random-quote HTTP/1.1
Host: www.domain-a.com
...
Origin: http://www.domain-a.com
...
</code></pre><p><strong>Demande Cross-Domain avec jeton</strong></p><p>Si vous souhaitez authoriser des ressources du serveur NodeAtlas aux requ&#xEA;tes en provenance de n&apos;importe quel domaine externe pour la page <code>/api/random-quote</code> et une page qui attend un jeton d&apos;authentification pour la page <code>/api/protected/random-quote</code>, vous pouvez le faire ainsi :</p><pre><code class="lang-json">{
    &quot;mimeType&quot;: &quot;application/json&quot;,
    &quot;headers&quot;: {
        &quot;Access-Control-Allow-Origin&quot;: &quot;*&quot;,
        &quot;Access-Control-Allow-Headers&quot;: &quot;Authorization&quot;
    },
    &quot;routes&quot;: {
        &quot;/api/random-quote&quot;: {
            &quot;controller&quot;: &quot;get-quote.js&quot;
        },
        &quot;/api/protected/random-quote&quot;: {
            &quot;controller&quot;: &quot;get-quote.js&quot;,
            &quot;middlewares&quot;: &quot;is-authenticated.js&quot;,
            &quot;options&quot;: true
        }
    }
}
</code></pre><p>Faire lire un jeton &#xE0; NodeAtlas depuis un domaine externe n&#xE9;cessite de lui passer l&apos;en-t&#xEA;te HTML <code>Authorization</code>. Pour que celle-ci soit accept&#xE9; par NodeAtlas il faut le d&#xE9;finir avec <code>Access-Control-Allow-Headers</code> acceptant <code>Authorization</code>. L&apos;envoi d&apos;un jeton n&#xE9;cessitant une requ&#xEA;te pr&#xE9;-v&#xE9;rifi&#xE9;e, il faut &#xE9;galement mettre <code>options</code> &#xE0; <code>true</code> pour autoriser les requ&#xEA;tes HTTP avec la m&#xE9;thode OPTIONS.</p><p>Ainsi vous pourrez par exemple accepter la requ&#xEA;te suivante qui passe un jeton d&apos;authentification &#xE0; notre serveur pour la ressource <code>/api/protected/random-quote</code> :</p><pre><code class="lang-bash">GET /api/protected/random-quote HTTP/1.1
Host: localhost:1337
...
Origin: http://localhost
Authorization: Bearer CODE_DU_JETON
...
</code></pre><p><strong>Autre demande Cross-Domain</strong></p><p>Toutes les ent&#xEA;tes pr&#xE9;vues pour faire fonctionner CORS sont accept&#xE9; via le m&#xE9;canisme d&apos;ajout d&apos;en-t&#xEA;te de NodeAtlas.</p><h3 id="changer-les-parametres-des-sessions">Changer les param&#xE8;tres des Sessions</h3><h4 id="cl-et-secret">Cl&#xE9; et Secret</h4><p>NodeAtlas g&#xE8;re lui-m&#xEA;me les sessions stock&#xE9;es sur le serveur avec comme param&#xE8;tres initiaux :</p><ul>
<li>Key : <code>nodeatlas.sid</code></li>
<li>Secret : <code>1234567890b&#xE9;po</code></li>
</ul><p>qui permettent &#xE0; un client de rester connect&#xE9; &#xE0; travers les pages &#xE0; un m&#xEA;me ensemble de variable personnelles c&#xF4;t&#xE9;s serveur.</p><p>Il est possible de modifier ses param&#xE8;tres par d&#xE9;faut (et m&#xEA;me obligatoire pour des sites en productions) avec les param&#xE8;tres de <code>webconfig.json</code> suivant :</p><pre><code class="lang-json">{
    sessionKey: &quot;cl&#xE9; personnelle&quot;,
    sessionSecret: &quot;secret personnel&quot;
}
</code></pre><p>NodeAtlas utilise &#xE9;galement un objet de stockage m&#xE9;moire (MemoryStore) qui stocke les informations dans la RAM du serveur.</p><h4 id="autres-param-tres">Autres param&#xE8;tres</h4><p>Il est possible de changer l&apos;int&#xE9;gralit&#xE9; des param&#xE8;tres des sessions (sauf le MemoryStore) en utilisant la configuration de <code>webconfig.json</code> suivante :</p><pre><code class="lang-json">{
    &quot;session&quot;: {
        &quot;key&quot;: &quot;cl&#xE9; personnelle&quot;,
        &quot;secret&quot;: &quot;secret personnel&quot;,
        &quot;cookie&quot;: {
            &quot;path&quot;: &apos;/&apos;,
            &quot;httpOnly&quot;: true,
            &quot;secure&quot;: false,
            &quot;maxAge&quot;: null
        },
        ...,
        ...,
        ...
    }
}
</code></pre><p>L&apos;int&#xE9;gralit&#xE9; de la configuration possible se trouve sur la documentation du module <a href="https://github.com/expressjs/session">express-session</a>.</p><h3 id="stockage-externe-des-sessions">Stockage externe des Sessions</h3><p>Par d&#xE9;faut, c&apos;est NodeAtlas qui stocke les sessions serveurs dans la RAM du serveur par application. Cela ne permet pas de partager des sessions utilisateurs &#xE0; travers plusieurs applications NodeAtlas (ou autre) et efface toutes les sessions en cours pour une application en cas de red&#xE9;marrage de celle-ci.</p><p>Pour r&#xE9;soudre ce souci, il convient de prendre en charge l&apos;enregistrement des sessions via une base No SQL tel que <code>Redis</code> ou <code>MongoBD</code>.</p><p>Pour cela il suffit d&apos;utiliser la fonction <code>setSessions</code> dans le fichier de <code>controller</code> commun.</p><h4 id="session-g-r-es-avec-redis">Session g&#xE9;r&#xE9;es avec Redis</h4><p>Impl&#xE9;menter le code suivant dans le <code>controller</code> commun pour stocker vos sessions dans Redis en local.</p><pre><code>exports.setModules = function () {
    var NA = this;

    NA.modules.RedisStore = require(&quot;connect-redis&quot;);
};

exports.setSessions = function (njsext) {
    var NA = this,
        session = NA.modules.session,
        RedisStore = NA.modules.RedisStore(session);

    NA.sessionStore = new RedisStore();

    next();
};
</code></pre><p>Plus d&apos;informations sur <a href="https://www.npmjs.org/package/connect-redis">connect-redis</a>.</p><h4 id="session-g-r-es-avec-mongodb">Session g&#xE9;r&#xE9;es avec MongoDB</h4><p>Impl&#xE9;menter le code suivant dans <code>controllers/common.js</code> pour stocker vos sessions dans la database <code>sessions</code> d&apos;une MongoDB locale.</p><pre><code>exports.setModules = function () {
    var NA = this;

    NA.modules.MongoStore = require(&quot;connect-mongo&quot;);
};

exports.setSessions = function (next) {
    var NA = this,
        session = NA.modules.session,
        MongoStore = NA.modules.MongoStore(session);

    NA.sessionStore = new MongoStore({
        db: &quot;sessions&quot;
    });

    next();
};
</code></pre><p>Plus d&apos;informations sur <a href="https://www.npmjs.org/package/connect-mongo">connect-redis</a>.</p><h3 id="changer-l-url-final-des-hostname-et-port-d-ecoute">Changer l&apos;url final des hostname et port d&apos;&#xE9;coute</h3><p>Il est possible de g&#xE9;n&#xE9;rer une url de visite diff&#xE9;rente des param&#xE8;tres d&apos;&#xE9;coutes demand&#xE9;s avec <code>urlHostname</code> et <code>urlPort</code>. Par exemple on &#xE9;coute la boucle local sur le port 80 car un script fait du Reverse Proxy depuis le port 7777 sur le 80 avec le module &#xAB; http-proxy &#xBB; comme ci-dessous :</p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;httpHostname&quot;: &quot;127.0.0.1&quot;,
    &quot;urlPort&quot;: 80,
    &quot;urlHostname&quot;: &quot;localhost&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><h3 id="generer-les-urls-dynamiquement">G&#xE9;n&#xE9;rer les urls dynamiquement</h3><h4 id="les-chemins-relatifs-en-absolue">Les chemins relatifs en absolue</h4><p>Il est possible que les chemins cr&#xE9;&#xE9;s &#xE0; partir de votre url soient interpr&#xE9;t&#xE9;s comme des sous-dossiers qui n&apos;ont en r&#xE9;alit&#xE9; aucune existence r&#xE9;elle. Cela a pour cons&#xE9;quence de rendre l&apos;adresse <code>media/images/example.jpg</code> initialement accessible depuis un template affich&#xE9; &#xE0; <strong><a href="http://localhost">http://localhost</a></strong> impossible &#xE0; r&#xE9;cup&#xE9;rer quand le template est affich&#xE9; &#xE0; <strong><a href="http://localhost/sub-directory/">http://localhost/sub-directory/</a></strong> (puisqu&apos;il faudrait alors que notre chemin soit plut&#xF4;t <code>../media/images/example.jpg</code>).</p><p>Pour ne plus avoir &#xE0; se soucier de l&apos;acc&#xE8;s aux ressources peu importe l&apos;url qui est demand&#xE9;e, il suffit de transformer toutes les urls relatives telles que :</p><pre><code>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;stylesheets/common.css&quot; /&gt;
&lt;!-- ... --&gt;
&lt;img src=&quot;media/images/example.jpg&quot; /&gt;
&lt;!-- ... --&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;javascripts/common.js&quot;&gt;&lt;/script&gt;
</code></pre><p>en urls absolues avec la variable <code>urlBasePath</code> comme ci-dessous :</p><pre><code>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&lt;?= urlBasePath ?&gt;stylesheets/common.css&quot; /&gt;
&lt;!-- ... --&gt;
&lt;img src=&quot;&lt;?= urlBasePath ?&gt;media/images/example.jpg&quot; /&gt;
&lt;!-- ... --&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;?= urlBasePath ?&gt;javascripts/common.js&quot;&gt;&lt;/script&gt;
</code></pre><p>&#xC0; noter que dans le cas de la configuration suivante :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><code>urlBasePath</code> retourne <code>http://localhost/</code> alors que dans celle-ci :</p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;urlRelativeSubPath&quot;: &quot;sub/folder&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        }
    }
}
</code></pre><p><code>urlBasePath</code> retourne <code>http://localhost:7777/sub/folder/</code>.</p><h4 id="les-chemins-des-templates">Les chemins des templates</h4><p>En utilisant le webconfig suivant :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/index.html&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;/contact.html&quot;: {
            &quot;view&quot;: &quot;contact.htm&quot;
        }
    }
}
</code></pre><p>ainsi que la view <code>index.htm</code> correspondante</p><pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href=&quot;http://localhost/index.html&quot;&gt;Lien vers l&apos;accueil&lt;/a&gt;
&lt;a href=&quot;http://localhost/contact.html&quot;&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre><p>je serais oblig&#xE9; de changer mon lien dans le template si je change le port d&apos;&#xE9;coute ou si je change le chemin de l&apos;url. Le changement de configuration suivant :</p><pre><code class="lang-json">{
    &quot;httpPort&quot;: 7777,
    &quot;routes&quot;: {
        &quot;/home.html&quot;: {
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;/contact-us.html&quot;: {
            &quot;view&quot;: &quot;contact.htm&quot;
        }
    }
}
</code></pre><p>me contraindrait &#xE0; modifier le template pr&#xE9;c&#xE9;dent comme suit :</p><pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href=&quot;http://localhost:7777/home.html&quot;&gt;Lien vers l&apos;accueil&lt;/a&gt;
&lt;a href=&quot;http://localhost:7777/contact-us.html&quot;&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre><p>Il est possible de solutionner ce probl&#xE8;me en donnant une cl&#xE9; &#xE0; un chemin pr&#xE9;cis et en d&#xE9;portant son chemin dans la propri&#xE9;t&#xE9; <code>url</code>.</p><p>Avec le webconfig suivant :</p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;index&quot;: {
            &quot;url&quot;: &quot;/index.html&quot;,
            &quot;view&quot;: &quot;index.htm&quot;
        },
        &quot;contact&quot;: {
            &quot;url&quot;: &quot;/contact.html&quot;,
            &quot;view&quot;: &quot;contact.htm&quot;
        }
    }
}
</code></pre><p>je peux &#xE0; pr&#xE9;sent &#xE9;crire le lien dans le template de mani&#xE8;re dynamique :</p><ol>
<li><p>comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href=&quot;&lt;?= urlBasePath ?&gt;&lt;?= webconfig.routes.home.url.slice(1) ?&gt;&quot;&gt;Lien vers l&apos;accueil&lt;/a&gt;
&lt;a href=&quot;&lt;?= urlBasePath ?&gt;&lt;?= webconfig.routes.contact.url.slice(1) ?&gt;&quot;&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : <code>.slice(1)</code> permet de supprimer facilement le double <code>/</code> pour une url fonctionnelle.</em></p>
</li>
<li><p>ou comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href=&quot;&lt;?= urlBasePath ?&gt;.&lt;?= webconfig.routes.home.url ?&gt;&quot;&gt;Lien vers l&apos;accueil&lt;/a&gt;
&lt;a href=&quot;&lt;?= urlBasePath ?&gt;.&lt;?= webconfig.routes.contact.url ?&gt;&quot;&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : Cela donnerait par exemple <code>http://localhost/./home.html</code>, ce qui est une url fonctionnelle.</em></p>
</li>
<li><p>ou comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href=&quot;&lt;?= urlBasePathSlice + webconfig.routes.home.url ?&gt;&quot;&gt;Lien vers l&apos;accueil&lt;/a&gt;
&lt;a href=&quot;&lt;?= urlBasePathSlice + webconfig.routes.contact.url ?&gt;&quot;&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : <code>urlBasePathSlice</code> renvoyant <code>http://localhost</code> au lieu de <code>http://localhost/</code> ou encore <code>http://localhost:7777/sub/folder</code> au lieu de <code>http://localhost:7777/sub/folder/</code>.</em></p>
</li>
</ol><h4 id="utilisation-de-la-cl-pour-mapper-les-pages">Utilisation de la cl&#xE9; pour mapper les pages</h4><p>Il est parfois utile de conna&#xEE;tre la cl&#xE9; utilis&#xE9; pour la page courante afin de trouver une &#xE9;quivalence dans une autre langue par exemple.</p><p>Avec le webconfig suivant :</p><pre><code class="lang-json">{
    &quot;languageCode&quot;: &quot;fr-fr&quot;,
    &quot;routes&quot;: {
        &quot;index_fr-fr&quot;: {
            &quot;url&quot;: &quot;/&quot;,
            &quot;view&quot;: &quot;/index.htm&quot;
        },
        &quot;index_en-us&quot;: {
            &quot;url&quot;: &quot;/english/&quot;,
            &quot;view&quot;: &quot;index.htm&quot;,
            &quot;languageCode&quot;: &quot;en-us&quot;
        },
        &quot;cv_fr-fr&quot;: {
            &quot;url&quot;: &quot;/cv/&quot;,
            &quot;view&quot;: &quot;cv.htm&quot;
        },
        &quot;cv_en-us&quot;: {
            &quot;url&quot;: &quot;/english/resume/&quot;,
            &quot;view&quot;: &quot;index.htm&quot;,
            &quot;languageCode&quot;: &quot;en-us&quot;
        }
    }
}
</code></pre><p>et les fichiers de variation commun suivant en fr :</p><pre><code class="lang-json">{
    &quot;language&quot;: [{
        &quot;name&quot;: &quot;Anglais&quot;,
        &quot;code&quot;: &quot;en-us&quot;
    }, {
        &quot;name&quot;: &quot;Fran&#xE7;ais&quot;,
        &quot;code&quot;: &quot;fr-fr&quot;
    }]
}
</code></pre><p>et en en :</p><pre><code class="lang-json">{
    &quot;language&quot;: [{
        &quot;name&quot;: &quot;English&quot;,
        &quot;code&quot;: &quot;en-us&quot;
    }, {
        &quot;name&quot;: &quot;French&quot;,
        &quot;code&quot;: &quot;fr-fr&quot;
    }]
}
</code></pre><p>on peut alors cr&#xE9;er un lien entre chaque page multilingue comme ceci :</p><pre><code class="lang-html">&lt;ul&gt;
    &lt;? for (var i = 0; i &lt; common.language.length; i++) { ?&gt;
    &lt;li&gt;&lt;a href=&quot;&lt;?= urlBasePath + webconfig.routes[routeKey.split(&apos;_&apos;)[0] + &apos;_&apos; + common.language[i].code].url ?&gt;&quot;&gt;&lt;?- common.language[i].name ?&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;? } ?&gt;
&lt;/ul&gt;
</code></pre><h3 id="moteur-de-template-personnalise">Moteur de template personnalis&#xE9;</h3><p>Il est possible de laisser l&apos;impl&#xE9;mentation de <a href="http://expressjs.com/fr/guide/using-template-engines.html">Express prendre la main sur le moteur de rendu des vues</a>. Pour cela il faut utiliser le param&#xE8;tre <code>engine</code>. Un exemple en utilisant le moteur Handlebars :</p><p>Tout d&apos;abord, ajouter le middleware Express Handlebars &#xE0; vos modules :</p><pre><code>npm install express-handlebars
</code></pre><p>puis utiliser <code>engine</code> avec la valeur arbitraire <code>hbs</code></p><pre><code>{
    &quot;engine&quot;: &quot;hbs&quot;,
    &quot;controller&quot;: &quot;common.js&quot;,
    &quot;variation&quot;: &quot;common.json&quot;,
    &quot;routes&quot;: {
        &quot;/&quot;: {
            &quot;view&quot;: &quot;index.hbs&quot;,
            &quot;variation&quot;: &quot;index.json&quot;
        }
    }
}
</code></pre><p>puis expliquer au moteur Express de NodeAtlas comment rendre les vues :</p><pre><code class="lang-js">exports.setModules = function () {
    var NA = this;

    NA.modules.exphbs = require(&quot;express-handlebars&quot;);
};

exports.setConfigurations = function (next) {
  var NA = this,
    exphbs = NA.modules.exphbs;

    NA.express.engine(&quot;hbs&quot;, exphbs());

    next();
};
</code></pre><p>enfin voyons rapidement ce que le fichier <code>index.hbs</code> pourrait contenir :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr-fr&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;title&gt;{{specific.titlePage}}&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/{{common.classCssCommon}}.css&quot; media=&quot;all&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/{{specific.classPage}}.css&quot; media=&quot;all&quot;&gt;
    &lt;/head&gt;
    &lt;body class=&quot;{{specific.classPage}}&quot;&gt;
        &lt;div&gt;
            &lt;h1&gt;{{specific.titlePage}}&lt;/h1&gt;
            {{{specific.content}}}
        &lt;/div&gt;
        &lt;script async=&quot;true&quot; type=&quot;text/javascript&quot; src=&quot;javascripts/{{common.classJsCommon}}.js&quot;&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Ce que fait <code>engine</code>, c&apos;est abandonner le syst&#xE8;me de NodeAtlas et passer par celui d&apos;Express. Comme Express a besoin d&apos;un objet <code>response</code> pour rendre une vue, il est impossible d&apos;utiliser ce m&#xE9;canisme via l&apos;utilisation de la fonction <code>NA.view</code> de l&apos;API NodeAtlas, celle-ci ne supportant que le moteur NodeAtlas, EJS et Pug.</p><h4 id="diff-rence-entre-engine-templateenginedelimiter-et-pug-">Diff&#xE9;rence entre <code>engine</code>, <code>templateEngineDelimiter</code> et <code>pug</code></h4><p>Il est tout a fait possible de passer par Express pour rendre EJS et Pug. Dans ce cas, puisque <code>node-atlas</code> embarque les modules <code>ejs</code> et <code>pug</code> en tant que d&#xE9;pendance, il n&apos;est pas n&#xE9;c&#xE9;ssaire de passer par le <code>controller</code> commun et l&apos;utilisation de <code>npm</code> pour les mettre en place. Il suffit juste d&apos;utiliser <code>engine: &quot;ejs&quot;</code> ou <code>engine: &quot;pug&quot;</code>.</p><p>Cependant, faire cela retire les b&#xE9;n&#xE9;fices apporter par NodeAtlas pour l&apos;utilisation de ces deux moteurs comme par exemple le support des inclusions dynamique pour Pug dans la <code>view</code> avec <code>#{routeParameters.view}</code>.</p><h3 id="pas-de-vue">Pas de vue</h3><p>Il est possible de ne pas utiliser de vue et de seulement faire appel au contr&#xF4;leur. Dans ce cas le point d&apos;ancrage <code>changeVariations</code> est inutile. Il va falloir alimenter vous m&#xEA;me <code>locals.dom</code> dans le point d&apos;ancrage <code>changeDom</code>.</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    &quot;routes&quot;: {
        &quot;/(:member/)?&quot;: {
            &quot;controller&quot;: &quot;index.js&quot;,
            &quot;mimeType&quot;: &quot;application/json&quot;
        }
    }
}
</code></pre><p><em>controllers/index.js</em></p><pre><code class="lang-js">exports.changeDom = function (next, locals) {
    locals.dom = `{
  &quot;params&quot;: ${locals.params.member},
  &quot;query&quot;: ${locals.query.member},
  &quot;body&quot;: ${locals.body.member}
}`;

    next();
};
</code></pre><p>Ainsi &#xE0; l&apos;adresse <code>http://localhost/riri/?query=fifi</code> demand&#xE9; en POST avec le body <code>member=loulou</code> vous obtiendrez la sortie :</p><pre><code class="lang-json">{
  &quot;params&quot;: &quot;riri&quot;,
  &quot;query&quot;: &quot;fifi&quot;,
  &quot;body&quot;: &quot;loulou&quot;
}
</code></pre><h4 id="pas-de-routes">Pas de routes</h4><p>Pas un seul webconfig pr&#xE9;sent&#xE9; dans la documentation ne se passe du param&#xE8;tre <code>routes</code>. Pourtant il est facultatif au m&#xEA;me titre que tous les autres. Aussi avec le Webconfig suivant :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    &quot;controller&quot;: &quot;common.js&quot;
}
</code></pre><p>et le contr&#xF4;leur suivant :</p><p><em>controllers/common.js</em></p><pre><code class="lang-js">exports.setRoutes = function (next) {
    var NA = this,
        route = NA.webconfig.routes = {};

    route[&quot;/&quot;] = {
        &quot;mimeType&quot;: &quot;text/plain&quot;
    };

    next();
};

exports.changeDom = function (next, locals) {

    locals.dom = &quot;Hello World&quot;;

    next();
};
</code></pre><p>Il est tout &#xE0; fait possible d&apos;obtenir &#xE0; l&apos;adresse <code>http://localhost/</code> le simple message &#xAB; Hello World &#xBB;.</p><h3 id="activer-le-cache">Activer le cache</h3><p>C&apos;est une bonne chose de ne pas reservir des fichiers qui n&apos;ont pas boug&#xE9; pour la production. Vous pouvez mettre &#xE0; <code>true</code> la valeur du webconfig <code>cache</code> pour &#xE7;a:</p><pre><code class="lang-json">{
    cache: true,
    route: {
      &quot;/&quot;: &quot;index.htm&quot;
    }
}
</code></pre><p>Vous pouvez &#xE9;galement lancer <code>node-atlas</code> avec l&apos;option <code>--cache</code> :</p><blockquote>
<pre><code class="lang-bash">node-atlas --cache
</code></pre>
</blockquote><p>ou mettre votre variable d&apos;environnement <code>NODE_ENV</code> &#xE0; <code>production</code> :</p><blockquote>
<p>si vous &#xEA;tes sous Unix/MacOS</p>
<pre><code class="lang-bash">export NODE_ENV=production
</code></pre>
<p>ou si vous &#xEA;tes sur windows</p>
<pre><code class="lang-bash">SET NODE_ENV=production
</code></pre>
<p>ou vous pouvez d&#xE9;marrer NodeAtlas comme suit</p>
<pre><code class="lang-bash">NODE_ENV=production node-atlas
</code></pre>
<p>ou vous pouvez la d&#xE9;finir dans votre fichier JavaScript :</p>
<pre><code class="lang-js">process.env.NODE_ENV = &quot;production&quot;;
</code></pre>
</blockquote><div><div class="before">
							<a href="partie-controleur-et-modele.html">&#x25C4; Partie Contr&#xF4;leur et Mod&#xE8;le</a>
						</div><div class="after">
							<a href="anatomie-du-webconfig.html">Anatomie du Webconfig &#x25BA;</a>
						</div></div>
				</div>
			</div>
		</div>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		
		<script id="channel" data-channel="NodeAtlas/Aide" data-label="Chat d&apos;Aide" src="javascripts/common.min.js"></script>
		
		<script src="https://buttons.github.io/buttons.js"></script>
	
</body></html>